(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{139:function(e,t,n){},164:function(e,t,n){},174:function(e,t,n){},270:function(e,t,n){},320:function(e,t,n){e.exports=n(556)},325:function(e,t,n){},326:function(e,t,n){},327:function(e,t,n){},328:function(e,t,n){},433:function(e,t,n){},434:function(e,t,n){},472:function(e,t,n){},473:function(e,t,n){},474:function(e,t,n){},475:function(e,t,n){},476:function(e,t,n){},477:function(e,t,n){},478:function(e,t,n){},479:function(e,t,n){},480:function(e,t,n){},481:function(e,t,n){},483:function(e,t,n){},484:function(e,t,n){},485:function(e,t,n){},486:function(e,t,n){},487:function(e,t,n){},488:function(e,t,n){},489:function(e,t,n){},490:function(e,t,n){},547:function(e,t,n){},548:function(e,t,n){},549:function(e,t,n){},550:function(e,t,n){},552:function(e,t,n){},553:function(e,t,n){},554:function(e,t,n){},556:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(32),o=n.n(s),r=(n(325),n(326),n(5)),l=n(6),c=n(10),m=n(8),u=n(4),h=n(11),d=(n(327),n(328),n(139),n(69)),p=n(565),v=n(87),g=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,[{key:"getStatusList",value:function(){return[{name:"In A Meeting",value:"InAMeeting"},{name:"Commuting",value:"Commuting"},{name:"Out Sick",value:"OutSick"},{name:"Vacationing",value:"Vacationing"},{name:"Working Remotely",value:"WorkingRemotely"}]}},{key:"getStatusName",value:function(e){var t=this.getStatusList().find(function(t){return t.value===e});return t?t.name:""}},{key:"isNotActive",value:function(e){return"Active"!==e}}]),e}();var f=function(e){var t=e.conversation,n=new g;return i.a.createElement(d.b,{to:"/conversation/".concat(t.id)},i.a.createElement("div",{className:"sidebar-item list-item"+(e.active?" sidebar-active-item":"")+(t.unreadMessageCount&&!e.active?" unread-item":"")},t.userCount<=2&&(t.isTheOtherUserOnline||1===t.userCount)&&i.a.createElement("span",{className:"user-realtime-status",title:"active"},i.a.createElement("span",{className:"user-realtime-status-circle"})),t.userCount<=2&&!(t.isTheOtherUserOnline||1===t.userCount)&&i.a.createElement("span",{className:"user-realtime-status user-offline",title:"away"},i.a.createElement("span",{className:"user-realtime-status-circle"})),t.userCount>2&&i.a.createElement("span",{className:"sidebar-item-other-user-count"},t.userCount-1),i.a.createElement(p.a,{trigger:i.a.createElement("span",{className:"sidebar-item-name"},t.name),content:t.name,inverted:!0,position:"top center",size:"tiny",disabled:!(t.name.length>18)}),function(){if(t.otherUserStatus&&n.isNotActive(t.otherUserStatus)){var e=n.getStatusName(t.otherUserStatus);return i.a.createElement(p.a,{trigger:i.a.createElement(v.a,{name:"flag",className:"status-icon sidebar-item-other-user-status"}),content:e,inverted:!0,position:"top center",size:"mini"})}}(),i.a.createElement("span",{className:"unread-badge"+(!t.unreadMessageCount||e.active?" invisible":"")},t.unreadMessageCount)))};var b=function(e){return i.a.createElement(d.b,{to:"/channel/".concat(e.channel.id)},i.a.createElement(p.a,{trigger:i.a.createElement("div",{className:"sidebar-item list-item"+(e.active?" sidebar-active-item":"")+(e.channel.hasUnreadMessage&&!e.active?" unread-item":"")},i.a.createElement("span",{className:"sidebar-item-name"},e.channel.name),i.a.createElement("span",{className:"unread-badge"+(!e.channel.unreadMentionCount||e.active?" invisible":"")},e.channel.unreadMentionCount)),content:e.channel.name,inverted:!0,position:"top center",size:"tiny",disabled:!(e.channel.name.length>18)}))},C=n(566),S=n(15),E=function(){function e(){Object(r.a)(this,e),this.localStorageKey="ichat.user"}return Object(l.a)(e,[{key:"setProfile",value:function(e){localStorage.setItem(this.localStorageKey,JSON.stringify(e))}},{key:"getProfile",value:function(){return localStorage.getItem(this.localStorageKey)?JSON.parse(localStorage.getItem(this.localStorageKey)):null}},{key:"getToken",value:function(){var e=this.getProfile();return e&&e.token}}]),e}(),y=function(){function e(t){Object(r.a)(this,e),this.props=t,this.profileService=new E}return Object(l.a)(e,[{key:"fetchErrorHandler",value:function(e){return console.error(e),Promise.reject(e)}},{key:"fetch",value:function(e,t,n,a){return this.fetchCommon(e,t,n,a).then(function(e){return e.ok?e.headers.get("content-type")&&e.headers.get("content-type").includes("application/json")?e.json():e.text():e.text().then(function(e){return Promise.reject(e)})}).then(function(e){return Promise.resolve(e)}).catch(this.fetchErrorHandler)}},{key:"fetchFile",value:function(e){return this.fetchCommon(e).then(function(e){return e.ok?e.blob():e.text().then(function(e){return Promise.reject(e)})}).then(function(e){return URL.createObjectURL(e)}).catch(this.fetchErrorHandler)}},{key:"fetchCommon",value:function(e,t,n,a){if(!e)return Promise.reject("Empty url");if(!a){var i=this.profileService.getToken();if(!i)return this.props.history.push("/login"),Promise.reject("invalid token, taken to login")}var s="Bearer "+i;return t||(t={}),t.headers||(t.headers={}),n||(t.headers["Content-Type"]="application/json"),a||(t.headers.Authorization=s),fetch("http://localhost:58314".concat(e),t)}}]),e}(),O=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onJoinChannelFormSubmit=n.onJoinChannelFormSubmit.bind(Object(u.a)(n)),n.changeSelectedChannel=n.changeSelectedChannel.bind(Object(u.a)(n)),n.apiService=new y(e),n.state={channelList:[]},n.selectedChannelId=void 0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onJoinChannelFormSubmit",value:function(e){var t=this;if(e.preventDefault(),this.selectedChannelId){var n=e.currentTarget.querySelector("button[type='submit']");n.classList.add("disabled-button"),this.apiService.fetch("/api/channels/join",{method:"POST",body:JSON.stringify(this.selectedChannelId)}).then(function(){t.props.onChannelJoined(),t.props.history.push("/channel/".concat(t.selectedChannelId))}).catch(function(e){S.b.error("Join channel failed: ".concat(e)),n.classList.remove("disabled-button")})}}},{key:"changeSelectedChannel",value:function(e,t){this.selectedChannelId=t.value}},{key:"componentDidMount",value:function(){var e=this;this.apiService.fetch("/api/channels/allUnsubscribed").then(function(t){var n=t.map(function(e){return{key:e.id,text:e.name,value:e.id}});e.setState({channelList:n})})}},{key:"render",value:function(){return i.a.createElement("div",{className:"form-container form-with-dropdown"},i.a.createElement("h1",{style:{textAlign:"center"}},"Join a channel"),i.a.createElement("form",{id:"JoinChannelForm",method:"post",onSubmit:this.onJoinChannelFormSubmit},i.a.createElement("p",{className:"form-description"},"Select a channel to join."),i.a.createElement(C.a,{placeholder:"Search channel",fluid:!0,search:!0,selection:!0,options:this.state.channelList,onChange:this.changeSelectedChannel}),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Join")))}}]),t}(i.a.Component),k=(n(433),n(434),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onKeyup=n.onKeyup.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keyup",this.onKeyup)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.onKeyup)}},{key:"onKeyup",value:function(e){"Escape"===e.key&&this.props.onClose()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("button",{className:"close-button",onClick:this.props.onClose},i.a.createElement("div",{style:{fontSize:"1.5rem"}},i.a.createElement(v.a,{name:"times"})),i.a.createElement("div",null,"esc")))}}]),t}(i.a.Component)),j=n(86),N=(n(164),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).modalRoot=document.getElementById("modal-root"),n.el=document.createElement("div"),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.modalRoot.appendChild(this.el)}},{key:"componentWillUnmount",value:function(){this.modalRoot.removeChild(this.el)}},{key:"render",value:function(){var e=i.a.createElement("div",{className:"modal-panel-container"},i.a.createElement("div",{className:"modal-panel-overlay"},i.a.createElement(j.a,{className:"modal-panel panel"},i.a.createElement(k,{onClose:this.props.onClose}),this.props.children)));return o.a.createPortal(e,this.el)}}]),t}(i.a.Component)),M=function(){function e(t){Object(r.a)(this,e),this.localStorageKey="ichat.user",this.props=t,this.apiService=new y(t),this.profileService=new E}return Object(l.a)(e,[{key:"login",value:function(e,t){var n=this;return this.apiService.fetch("/api/identity/authenticate",{method:"POST",body:JSON.stringify({email:e,password:t})},!1,!0).then(function(e){n.profileService.setProfile(e),n.props.history.push("/")}).catch(function(e){return S.b.error("Login failed: ".concat(e)),Promise.reject()})}},{key:"isLoggedIn",value:function(){return!!this.profileService.getProfile()}},{key:"logout",value:function(){localStorage.removeItem(this.localStorageKey),this.props.history.push("/login")}}]),e}(),w=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).authService=new M(e),n.onJoinChannel=n.onJoinChannel.bind(Object(u.a)(n)),n.onChannelJoined=n.onChannelJoined.bind(Object(u.a)(n)),n.onCloseJoinChannelModal=n.onCloseJoinChannelModal.bind(Object(u.a)(n)),n.state={isJoinChannelModalOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onJoinChannel",value:function(e){e.stopPropagation(),this.setState({isJoinChannelModalOpen:!0})}},{key:"onChannelJoined",value:function(){this.onCloseJoinChannelModal(),this.props.onUpdateChannelList()}},{key:"onCloseJoinChannelModal",value:function(){this.setState({isJoinChannelModalOpen:!1})}},{key:"render",value:function(){return i.a.createElement("div",{className:"sidebar-item list-item"},i.a.createElement("span",{onClick:this.onJoinChannel},"+\xa0Join a channel"),i.a.createElement("div",null,this.state.isJoinChannelModalOpen&&i.a.createElement(N,{onClose:this.onCloseJoinChannelModal},i.a.createElement(O,Object.assign({onChannelJoined:this.onChannelJoined},this.props)))))}}]),t}(i.a.Component),P=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onCreateChannelFormSubmit=n.onCreateChannelFormSubmit.bind(Object(u.a)(n)),n.apiService=new y(e),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onCreateChannelFormSubmit",value:function(e){var t=this;e.preventDefault();var n=e.currentTarget.querySelector("button[type='submit']");n.classList.add("disabled-button");var a=e.target.elements.name.value,i=e.target.elements.topic.value;this.apiService.fetch("/api/channels",{method:"POST",body:JSON.stringify({name:a,topic:i})}).then(function(e){t.props.onChannelCreated(),t.props.history.push("/channel/".concat(e))}).catch(function(e){S.b.error("Create channel failed: ".concat(e)),n.classList.remove("disabled-button")})}},{key:"render",value:function(){return i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",{style:{textAlign:"center"}},"Create a channel"),i.a.createElement("form",{id:"createChannelForm",method:"post",onSubmit:this.onCreateChannelFormSubmit},i.a.createElement("p",{className:"form-description"},"Channels are where specific topics can be talked about."),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"createChannelName"},"Name"),i.a.createElement("input",{className:"form-control",type:"text",id:"createChannelName",name:"name",placeholder:"e.g. meetings",required:!0})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"createChannelTopic"},"Topic",i.a.createElement("span",{className:"secondary-text"},"\xa0(optional)")),i.a.createElement("input",{className:"form-control",type:"text",id:"createChannelTopic",name:"topic",placeholder:"What is this channel about?"})),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Create Channel")))}}]),t}(i.a.Component),F=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onStartConversationFormSubmit=n.onStartConversationFormSubmit.bind(Object(u.a)(n)),n.changeConversationUser=n.changeConversationUser.bind(Object(u.a)(n)),n.apiService=new y(e),n.state={userList:[]},n.conversationUserIds=[],n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onStartConversationFormSubmit",value:function(e){var t=this;if(e.preventDefault(),this.conversationUserIds&&0!==this.conversationUserIds.length){var n=e.currentTarget.querySelector("button[type='submit']");n.classList.add("disabled-button"),this.apiService.fetch("/api/conversations/start",{method:"POST",body:JSON.stringify(this.conversationUserIds)}).then(function(e){t.props.onConversationStarted(),t.props.history.push("/conversation/".concat(e))}).catch(function(e){S.b.error("Start conversation failed: ".concat(e)),n.classList.remove("disabled-button")})}}},{key:"changeConversationUser",value:function(e,t){this.conversationUserIds=t.value}},{key:"componentDidMount",value:function(){var e=this;this.apiService.fetch("/api/users").then(function(t){var n=e.props.userProfile.id,a=t.filter(function(e){return e.id!==n}).map(function(e){return{key:e.id,text:e.displayName,value:e.id}});e.setState({userList:a})})}},{key:"render",value:function(){return i.a.createElement("div",{className:"form-container form-with-dropdown"},i.a.createElement("h1",{style:{textAlign:"center"}},"Start conversation"),i.a.createElement("form",{id:"StartConversationForm",method:"post",onSubmit:this.onStartConversationFormSubmit},i.a.createElement("p",{className:"form-description"},"Select people you want to have a conversation with."),i.a.createElement(C.a,{placeholder:"Search user",fluid:!0,multiple:!0,search:!0,selection:!0,options:this.state.userList,onChange:this.changeConversationUser}),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Go")))}}]),t}(i.a.Component),I=n(568),L=n(562),T=n(309),U=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).apiService=new y(e),n.onCreateChannel=n.onCreateChannel.bind(Object(u.a)(n)),n.onCloseCreateChannel=n.onCloseCreateChannel.bind(Object(u.a)(n)),n.onChannelCreated=n.onChannelCreated.bind(Object(u.a)(n)),n.onStartConversation=n.onStartConversation.bind(Object(u.a)(n)),n.onCloseStartConversation=n.onCloseStartConversation.bind(Object(u.a)(n)),n.onConversationStarted=n.onConversationStarted.bind(Object(u.a)(n)),n.onUpdateChannelList=n.onUpdateChannelList.bind(Object(u.a)(n)),n.onUpdateConversationList=n.onUpdateConversationList.bind(Object(u.a)(n)),e.hubConnection&&(e.hubConnection.on("ChannelMessageItemChanged",n.onUpdateChannelList),e.hubConnection.on("ConversationMessageItemChanged",n.onUpdateConversationList),e.hubConnection.on("UnreadChannelMessageCleared",n.onUpdateChannelList),e.hubConnection.on("UnreadConversationMessageCleared",n.onUpdateConversationList),e.hubConnection.on("ConversationUserListChanged",n.onUpdateConversationList),e.hubConnection.on("UserWentOnline",n.onUpdateConversationList),e.hubConnection.on("UserStatusChanged",n.onUpdateConversationList)),n.state={channels:[],conversations:[],isCreateChannelModalOpen:!1,isPageLoading:!0},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onCreateChannel",value:function(e){this.setState({isCreateChannelModalOpen:!0})}},{key:"onCloseCreateChannel",value:function(){this.setState({isCreateChannelModalOpen:!1})}},{key:"onChannelCreated",value:function(){this.onCloseCreateChannel(),this.fetchChannels()}},{key:"onUpdateChannelList",value:function(){this.fetchChannels()}},{key:"onStartConversation",value:function(e){this.setState({isStartConversationModalOpen:!0})}},{key:"onCloseStartConversation",value:function(){this.setState({isStartConversationModalOpen:!1})}},{key:"onConversationStarted",value:function(){this.onCloseStartConversation(),this.fetchConversations()}},{key:"onUpdateConversationList",value:function(){this.fetchConversations()}},{key:"fetchChannels",value:function(){var e=this;return this.apiService.fetch("/api/channels/forUser").then(function(t){return e.setState({channels:t})})}},{key:"fetchConversations",value:function(){var e=this;return this.apiService.fetch("/api/conversations/recent").then(function(t){return e.setState({conversations:t})})}},{key:"componentDidMount",value:function(){var e=this;Promise.all([this.fetchChannels(),this.fetchConversations()]).then(function(){e.setState({isPageLoading:!1})})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{id:"sidebar"},this.state.isPageLoading&&i.a.createElement(I.a,null,i.a.createElement(L.a,{active:!0}),i.a.createElement(T.a,{src:"https://react.semantic-ui.com/images/wireframe/short-paragraph.png"}),i.a.createElement(T.a,{src:"https://react.semantic-ui.com/images/wireframe/short-paragraph.png"})),i.a.createElement(j.a,{className:"sidebar-scrollable"},i.a.createElement("section",null,i.a.createElement("div",{className:"section-title"},i.a.createElement("span",null,"CHANNELS"),i.a.createElement(p.a,{trigger:i.a.createElement(v.a,{name:"plus circle",className:"icon-circle",onClick:this.onCreateChannel}),content:"Create a channel",inverted:!0,position:"bottom center",size:"tiny"})),this.state.channels.map(function(t){var n=!1;return e.props.isChannel&&e.props.id===t.id&&(n=!0),i.a.createElement(b,{key:t.id,channel:t,active:n})}),i.a.createElement("div",null,this.state.isCreateChannelModalOpen&&i.a.createElement(N,{onClose:this.onCloseCreateChannel},i.a.createElement(P,Object.assign({onChannelCreated:this.onChannelCreated},this.props))))),i.a.createElement("section",null,i.a.createElement(w,Object.assign({onUpdateChannelList:this.onUpdateChannelList},this.props))),i.a.createElement("section",null,i.a.createElement("div",{className:"section-title"},i.a.createElement("span",null,"DIRECT MESSAGES"),i.a.createElement(p.a,{trigger:i.a.createElement(v.a,{name:"plus circle",className:"icon-circle",onClick:this.onStartConversation}),content:"Start a conversation",inverted:!0,position:"top center",size:"tiny"})),this.state.conversations.map(function(t){var n=!1;return e.props.isChannel||e.props.id!==t.id||(n=!0),i.a.createElement(f,{key:t.id,conversation:t,active:n})}),i.a.createElement("div",null,this.state.isStartConversationModalOpen&&i.a.createElement(N,{onClose:this.onCloseStartConversation},i.a.createElement(F,Object.assign({onConversationStarted:this.onConversationStarted},this.props)))))))}}]),t}(i.a.Component),D=n(308),x=(n(472),n(473),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onOverlayClick=n.onOverlayClick.bind(Object(u.a)(n)),n.dropdownModalRoot=document.getElementById("dropdown-modal-root"),n.el=document.createElement("div"),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onOverlayClick",value:function(e){e.target.closest(".dropdown-modal-panel")||this.props.onClose()}},{key:"componentDidMount",value:function(){this.dropdownModalRoot.appendChild(this.el)}},{key:"componentWillUnmount",value:function(){this.dropdownModalRoot.removeChild(this.el)}},{key:"render",value:function(){var e=i.a.createElement("div",{className:"dropdown-modal-panel-container"},i.a.createElement("div",{className:"dropdown-modal-panel-overlay page-overlay",onClick:this.onOverlayClick},i.a.createElement("div",{className:"dropdown-modal-panel"},this.props.children)));return o.a.createPortal(e,this.el)}}]),t}(i.a.Component)),A=n(135),q=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onInviteOtherMembersFormSubmit=n.onInviteOtherMembersFormSubmit.bind(Object(u.a)(n)),n.changeInviteMembers=n.changeInviteMembers.bind(Object(u.a)(n)),n.apiService=new y(e),n.state={userList:[]},n.inviteMembersUserIds=[],n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onInviteOtherMembersFormSubmit",value:function(e){var t=this;if(e.preventDefault(),this.inviteMembersUserIds&&0!==this.inviteMembersUserIds.length){var n=e.currentTarget.querySelector("button[type='submit']");n.classList.add("disabled-button");var a="/api/".concat(this.props.isChannel?"channels":"conversations","/").concat(this.props.id,"/inviteOtherMembers");this.apiService.fetch(a,{method:"POST",body:JSON.stringify(this.inviteMembersUserIds)}).then(function(e){t.props.onClose(),t.props.isChannel||e===t.props.id||t.props.history.push("/conversation/".concat(e))}).catch(function(e){S.b.error("Invite other members failed: ".concat(e)),n.classList.remove("disabled-button")})}}},{key:"changeInviteMembers",value:function(e,t){this.inviteMembersUserIds=t.value}},{key:"componentDidMount",value:function(){var e=this,t=this.apiService.fetch("/api/users"),n=this.apiService.fetch("/api/".concat(this.props.isChannel?"channels":"conversations","/").concat(this.props.id,"/userIds"));Promise.all([t,n]).then(function(t){var n=Object(A.a)(t,2),a=n[0],i=n[1],s=a.filter(function(e){return i.every(function(t){return t!==e.id})}).map(function(e){return{key:e.id,text:e.displayName,value:e.id}});e.setState({userList:s})})}},{key:"render",value:function(){return i.a.createElement("div",{className:"form-container form-with-dropdown"},i.a.createElement("h1",{style:{textAlign:"center"}},"Invite other members"),i.a.createElement("form",{id:"InviteOtherMembersForm",method:"post",onSubmit:this.onInviteOtherMembersFormSubmit},i.a.createElement("p",{className:"form-description"},"Select people you want to invite to this",this.props.isChannel?" channel":" conversation","."),i.a.createElement(C.a,{placeholder:"Search user",fluid:!0,multiple:!0,search:!0,selection:!0,options:this.state.userList,onChange:this.changeInviteMembers}),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Go")))}}]),t}(i.a.Component),H=(n(474),function(e){function t(e){return Object(r.a)(this,t),Object(c.a)(this,Object(m.a)(t).call(this,e))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"form-container form-with-dropdown"},i.a.createElement("h1",{style:{textAlign:"center"}},"Member List"),i.a.createElement("form",{id:"showMemberListForm"},this.props.memberList.map(function(t){return i.a.createElement("div",{className:"member-list-item",key:t.id,onClick:function(n){return e.props.onOpenUserPopup(n.currentTarget,t.id)}},i.a.createElement("img",{className:"user-identicon",src:t.identiconPath}),i.a.createElement("b",null,t.displayName))})))}}]),t}(i.a.Component)),J=(n(475),n(476),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).addAnotherEmail=n.addAnotherEmail.bind(Object(u.a)(n)),n.removeEmail=n.removeEmail.bind(Object(u.a)(n)),n.onEmailFormSubmit=n.onEmailFormSubmit.bind(Object(u.a)(n)),n.apiService=new y(e),n.state={emailsToInvite:["","",""]},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"addAnotherEmail",value:function(){var e=this.state.emailsToInvite;e.push(""),this.setState({emailsToInvite:e})}},{key:"removeEmail",value:function(e){var t=this.state.emailsToInvite;t.splice(e,1),this.setState({emailsToInvite:t})}},{key:"onEmailFormSubmit",value:function(e){var t=this;e.preventDefault();var n=this.state.emailsToInvite.filter(function(e){return e&&!!e.trim()});if(0!==n.length){var a=e.currentTarget.querySelector("button[type='submit']");a.classList.add("disabled-button"),this.apiService.fetch("/api/users/invite",{method:"POST",body:JSON.stringify(n)}).then(function(){S.b.success("Invitation email sent!"),t.props.onClose()}).catch(function(e){S.b.error("Send Invitation failed: ".concat(e)),a.classList.remove("disabled-button")})}}},{key:"handleChange",value:function(e,t){var n=this.state.emailsToInvite;n[t]=e.target.value,this.setState({emailsToInvite:n})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",{style:{textAlign:"center"}},"Invite People to ",this.props.userProfile.workspaceName),i.a.createElement("form",{id:"emailForm",method:"post",onSubmit:this.onEmailFormSubmit},i.a.createElement("p",{className:"form-description"},"Enter email addresses to invite."),this.state.emailsToInvite.map(function(t,n){return i.a.createElement("div",{key:n,className:"email-row"},i.a.createElement("input",{className:"form-control",type:"email",placeholder:"Email",value:t,onChange:function(t){return e.handleChange(t,n)}}),e.state.emailsToInvite.length>1&&i.a.createElement(p.a,{trigger:i.a.createElement(v.a,{name:"times",className:"icon-times",onClick:function(){return e.removeEmail(n)}}),content:"Remove this email",inverted:!0,position:"right center",size:"tiny"}))}),i.a.createElement("div",{onClick:this.addAnotherEmail,className:"add-email"},i.a.createElement(v.a,{name:"plus circle",className:"icon-circle"}),i.a.createElement("span",null,"Add another")),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Send Invitation")))}}]),t}(i.a.Component)),R=(n(477),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onSetStatusFormSubmit=n.onSetStatusFormSubmit.bind(Object(u.a)(n)),n.apiService=new y(e),n.statusList=(new g).getStatusList(),n.state={selectedStatus:void 0},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onSetStatusFormSubmit",value:function(e){var t=this;if(e.preventDefault(),this.state.selectedStatus){var n=e.currentTarget.querySelector("button[type='submit']");n.classList.add("disabled-button"),this.apiService.fetch("/api/users/status",{method:"POST",body:JSON.stringify(this.state.selectedStatus)}).then(function(e){t.props.onClose(),t.props.onSelect()}).catch(function(e){S.b.error("Save status failed: ".concat(e)),n.classList.remove("disabled-button")})}}},{key:"onSelectStatus",value:function(e){this.selectedStatus=e,this.setState({selectedStatus:e})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",{style:{textAlign:"center"}},"Set a status"),i.a.createElement("form",{id:"setStatusForm",method:"post",onSubmit:this.onSetStatusFormSubmit},i.a.createElement("p",{className:"form-description"},"Set your status by clicking one of the following:"),i.a.createElement("ul",{className:"status-list"},this.statusList.map(function(t){var n=!1;return t.value===e.state.selectedStatus&&(n=!0),i.a.createElement("li",{key:t.value,className:n?"selected-status":"",onClick:function(){return e.onSelectStatus(t.value)}},t.name)})),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Save")))}}]),t}(i.a.Component)),G=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onEditProfileFormSubmit=n.onEditProfileFormSubmit.bind(Object(u.a)(n)),n.apiService=new y(e),n.displayName=void 0,n.phoneNumber=void 0,n.state={displayName:e.userProfile.displayName||"",phoneNumber:e.userProfile.phoneNumber||""},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onEditProfileFormSubmit",value:function(e){var t=this;e.preventDefault();var n=e.currentTarget.querySelector("button[type='submit']");n.classList.add("disabled-button");var a=e.target.elements.displayName.value,i=e.target.elements.phoneNumber.value;this.apiService.fetch("/api/users/editProfile",{method:"POST",body:JSON.stringify({displayName:a,phoneNumber:i})}).then(function(){t.props.onClose(),t.props.onProfileUpdated()}).catch(function(e){S.b.error("Edit profile failed: ".concat(e)),n.classList.remove("disabled-button")})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"form-container edit-profile-form"},i.a.createElement("h1",{style:{textAlign:"center"}},"Edit profile"),i.a.createElement("form",{id:"EditProfileForm",method:"post",onSubmit:this.onEditProfileFormSubmit},i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"displayName"},"Display Name"),i.a.createElement("input",{className:"form-control",type:"text",id:"displayName",name:"displayName",placeholder:"Display name",value:this.state.displayName,onChange:function(t){return e.setState({displayName:t.target.value})},required:!0})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"telephone"},"Phone Number"),i.a.createElement("input",{className:"form-control",type:"text",id:"phoneNumber",name:"phoneNumber",placeholder:"Phone Number",pattern:"[0-9-]*",title:"Phone number can only contain numbers and '-'",value:this.state.phoneNumber,onChange:function(t){return e.setState({phoneNumber:t.target.value})},required:!0})),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Save Changes")))}}]),t}(i.a.Component),W=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onHeaderClick=n.onHeaderClick.bind(Object(u.a)(n)),n.onCloseDropdown=n.onCloseDropdown.bind(Object(u.a)(n)),n.onInvitePeople=n.onInvitePeople.bind(Object(u.a)(n)),n.onCloseInvitePeople=n.onCloseInvitePeople.bind(Object(u.a)(n)),n.onCloseEditProfile=n.onCloseEditProfile.bind(Object(u.a)(n)),n.onSetStatus=n.onSetStatus.bind(Object(u.a)(n)),n.onEditProfile=n.onEditProfile.bind(Object(u.a)(n)),n.onClearStatus=n.onClearStatus.bind(Object(u.a)(n)),n.onCloseSetStatus=n.onCloseSetStatus.bind(Object(u.a)(n)),n.onLogout=n.onLogout.bind(Object(u.a)(n)),n.authService=new M(e),n.apiService=new y(e),n.userStatusService=new g,n.state={isInvitePeopleModalOpen:!1,isSetStatusModalOpen:!1,isEditProfileModalOpen:!1,isDropdownModalOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onHeaderClick",value:function(e){this.setState({isDropdownModalOpen:!0})}},{key:"onCloseDropdown",value:function(e){this.setState({isDropdownModalOpen:!1})}},{key:"onInvitePeople",value:function(e){this.setState({isInvitePeopleModalOpen:!0,isDropdownModalOpen:!1})}},{key:"onCloseInvitePeople",value:function(e){this.setState({isInvitePeopleModalOpen:!1})}},{key:"onSetStatus",value:function(e){this.setState({isSetStatusModalOpen:!0,isDropdownModalOpen:!1})}},{key:"onEditProfile",value:function(e){this.setState({isEditProfileModalOpen:!0,isDropdownModalOpen:!1})}},{key:"onClearStatus",value:function(e){var t=this;this.apiService.fetch("/api/users/clearStatus",{method:"POST"}).then(function(e){t.props.onUserSessionDataChange(),t.setState({isDropdownModalOpen:!1})}).catch(function(e){S.b.error("Clear status failed: ".concat(e))})}},{key:"onCloseSetStatus",value:function(e){this.setState({isSetStatusModalOpen:!1})}},{key:"onCloseEditProfile",value:function(e){this.setState({isEditProfileModalOpen:!1})}},{key:"onLogout",value:function(){this.authService.logout()}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{className:"header-user-info"},i.a.createElement("div",{className:"header-user-info-container",onClick:this.onHeaderClick},i.a.createElement("div",null,i.a.createElement(v.a,{name:"chevron down"}),i.a.createElement("span",{className:"header-user-info-workspace-name"},this.props.userProfile.workspaceName)),i.a.createElement("div",{className:"header-user-info-user-name"},this.props.userProfile.displayName,function(){if(e.userStatusService.isNotActive(e.props.userStatus)){var t=e.userStatusService.getStatusName(e.props.userStatus);return i.a.createElement(p.a,{trigger:i.a.createElement(v.a,{name:"flag",className:"status-icon"}),content:t,inverted:!0,position:"top right",size:"tiny"})}}())),this.state.isDropdownModalOpen&&i.a.createElement(x,{onClose:this.onCloseDropdown},i.a.createElement("div",{className:"header-user-info-dropdown dropdown-container panel"},i.a.createElement("section",{className:"dropdown-section"},i.a.createElement("div",{className:"dropdown-section-header"},i.a.createElement("img",{className:"user-identicon",src:this.props.userProfile.identiconPath}),this.props.userProfile.displayName),i.a.createElement("ul",null,this.userStatusService.isNotActive(this.props.userStatus)?i.a.createElement("li",{onClick:this.onClearStatus},"Clear status"):i.a.createElement("li",{onClick:this.onSetStatus},"Set status"),i.a.createElement("li",{onClick:this.onEditProfile},"Profile"))),i.a.createElement("section",{className:"dropdown-section"},i.a.createElement("div",{className:"dropdown-section-header"},this.props.userProfile.workspaceName),i.a.createElement("ul",null,i.a.createElement("li",{onClick:this.onInvitePeople},"Invite people"),i.a.createElement("li",{onClick:this.onLogout},"Log out of ",this.props.userProfile.workspaceName)))))),i.a.createElement("div",null,this.state.isSetStatusModalOpen&&i.a.createElement(N,{onClose:this.onCloseSetStatus},i.a.createElement(R,{onClose:this.onCloseSetStatus,onSelect:this.props.onUserSessionDataChange}))),i.a.createElement("div",null,this.state.isEditProfileModalOpen&&i.a.createElement(N,{onClose:this.onCloseEditProfile},i.a.createElement(G,{userProfile:this.props.userProfile,onClose:this.onCloseEditProfile,onProfileUpdated:this.props.onProfileUpdated}))),i.a.createElement("div",null,this.state.isInvitePeopleModalOpen&&i.a.createElement(N,{onClose:this.onCloseInvitePeople},i.a.createElement(J,{userProfile:this.props.userProfile,onClose:this.onCloseInvitePeople}))))}}]),t}(i.a.Component),B=(n(478),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).apiService=new y(e),n.onSettingButtonClicked=n.onSettingButtonClicked.bind(Object(u.a)(n)),n.onCloseSettingDropdown=n.onCloseSettingDropdown.bind(Object(u.a)(n)),n.onLeaveChannelClicked=n.onLeaveChannelClicked.bind(Object(u.a)(n)),n.onInviteOtherMembers=n.onInviteOtherMembers.bind(Object(u.a)(n)),n.onCloseInviteOtherMembers=n.onCloseInviteOtherMembers.bind(Object(u.a)(n)),n.onShowMemberList=n.onShowMemberList.bind(Object(u.a)(n)),n.onCloseShowMemberList=n.onCloseShowMemberList.bind(Object(u.a)(n)),n.state={isSettingDropdownModalOpen:!1,isInviteOtherMembersModalOpen:!1,isShowMemberListModalOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onSettingButtonClicked",value:function(){this.setState({isSettingDropdownModalOpen:!0})}},{key:"onCloseSettingDropdown",value:function(){this.setState({isSettingDropdownModalOpen:!1})}},{key:"onLeaveChannelClicked",value:function(){var e=this,t=this.props.userProfile.defaultChannelId;this.apiService.fetch("/api/channels/leave",{method:"POST",body:JSON.stringify(this.props.id)}).then(function(n){e.onCloseSettingDropdown(),e.props.history.push("/channel/".concat(t))}).catch(function(e){S.b.error("Leave channel failed: ".concat(e))})}},{key:"onInviteOtherMembers",value:function(){this.setState({isInviteOtherMembersModalOpen:!0,isSettingDropdownModalOpen:!1})}},{key:"onCloseInviteOtherMembers",value:function(){this.setState({isInviteOtherMembersModalOpen:!1})}},{key:"onShowMemberList",value:function(){this.setState({isShowMemberListModalOpen:!0,isSettingDropdownModalOpen:!1})}},{key:"onCloseShowMemberList",value:function(){this.setState({isShowMemberListModalOpen:!1})}},{key:"componentDidUpdate",value:function(e){this.props.isChannel===e.isChannel&&this.props.id===e.id||this.onCloseShowMemberList()}},{key:"render",value:function(){return i.a.createElement("div",{className:"content-header-settings-container"},i.a.createElement("span",{onClick:this.onSettingButtonClicked},i.a.createElement(p.a,{trigger:i.a.createElement(v.a,{name:"setting",className:"icon-setting"}),content:"".concat(this.props.isChannel?"Channel":"Conversation"," settings"),inverted:!0,position:"bottom center",size:"tiny"})),this.state.isSettingDropdownModalOpen&&i.a.createElement(x,{onClose:this.onCloseSettingDropdown},i.a.createElement("div",{className:"setting-dropdown dropdown-container panel"},i.a.createElement("section",{className:"dropdown-section"},i.a.createElement("ul",null,i.a.createElement("li",{onClick:this.onShowMemberList},"Show member list"),(this.props.isChannel||!this.props.selectedConversation.isPrivate&&!this.props.selectedConversation.isSelfConversation)&&i.a.createElement("li",{onClick:this.onInviteOtherMembers},this.props.isChannel?"Invite people to ".concat(this.props.selectedChannel.name):"Invite another member"),this.props.isChannel&&this.props.id!==this.props.userProfile.defaultChannelId&&i.a.createElement("li",{onClick:this.onLeaveChannelClicked},"Leave ".concat(this.props.selectedChannel.name)))))),i.a.createElement("div",null,this.state.isInviteOtherMembersModalOpen&&i.a.createElement(N,{onClose:this.onCloseInviteOtherMembers},i.a.createElement(q,Object.assign({onClose:this.onCloseInviteOtherMembers},this.props)))),i.a.createElement("div",null,this.state.isShowMemberListModalOpen&&i.a.createElement(N,{onClose:this.onCloseShowMemberList},i.a.createElement(H,Object.assign({memberList:this.props.messageChannelUserList,onOpenUserPopup:this.props.onOpenUserPopup,onClose:this.onCloseShowMemberList},this.props)))))}}]),t}(i.a.Component)),V=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).fetchData=n.fetchData.bind(Object(u.a)(n)),n.apiService=new y(e),e.hubConnection&&e.hubConnection.on("ConversationUserListChanged",function(){return n.fetchData(n.props)}),n.state={selectedChannel:{},selectedConversation:{}},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"fetchData",value:function(e){var t=this;e.isChannel?this.apiService.fetch("/api/channels/".concat(e.id)).then(function(e){return t.setState({selectedChannel:e})}):this.apiService.fetch("/api/conversations/".concat(e.id)).then(function(e){return t.setState({selectedConversation:e})})}},{key:"componentDidMount",value:function(){this.fetchData(this.props)}},{key:"componentDidUpdate",value:function(e){this.props.isChannel===e.isChannel&&this.props.id===e.id||this.fetchData(this.props)}},{key:"render",value:function(){return i.a.createElement("div",{className:"content-header"},i.a.createElement("div",{className:"content-header-details"},i.a.createElement("div",{className:"content-header-name"},this.props.isChannel?this.state.selectedChannel.name:this.state.selectedConversation.name,i.a.createElement("div",{className:"content-header-settings"},i.a.createElement(B,Object.assign({selectedChannel:this.state.selectedChannel,selectedConversation:this.state.selectedConversation},this.props)))),i.a.createElement("div",{className:"content-header-topic"},this.props.isChannel?this.state.selectedChannel.topic:"")),i.a.createElement("div",null,i.a.createElement(W,this.props)))}}]),t}(i.a.Component),z=(n(479),n(564)),K=(n(480),n(293)),_=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,[{key:"convertColonsToHtml",value:function(e){var t=new K.EmojiConvertor;return t.img_sets.google.path="https://unpkg.com/emoji-datasource-google@4.0.4/img/google/sheets-256/",t.img_sets.google.sheet="https://unpkg.com/emoji-datasource-google@4.0.4/img/google/sheets-256/64.png",t.img_set="google",t.use_sheet=!0,t.replace_colons(e)}}]),e}(),Y=(n(481),n(307)),Q=(n(483),n(294)),$=(n(484),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).modalRoot=document.getElementById("blank-modal-root"),n.el=document.createElement("div"),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.modalRoot.appendChild(this.el)}},{key:"componentWillUnmount",value:function(){this.modalRoot.removeChild(this.el)}},{key:"render",value:function(){var e=i.a.createElement("div",{className:"blank-modal-panel"},this.props.children);return o.a.createPortal(e,this.el)}}]),t}(i.a.Component)),Z=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).closePopup=n.closePopup.bind(Object(u.a)(n)),n.onKeyup=n.onKeyup.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"closePopup",value:function(){this.props.onClose()}},{key:"onKeyup",value:function(e){e.ctrlKey||e.shiftKey||e.altKey||27!==e.keyCode||this.props.onClose()}},{key:"calculatePostion",value:function(){var e=document.querySelector(".page-overlay-content"),t=e.firstChild.getBoundingClientRect(),n=this.props.clickedTarget.getBoundingClientRect(),a=n.bottom-t.height,i=n.right+10,s=document.querySelector(".content-header").offsetHeight,o=0,r=0;a<s&&(o=s-a+10),i+t.right>window.innerWidth&&(r=window.innerWidth-(i+t.right)-10),e.setAttribute("style","top:".concat(a,"px; left: ").concat(i,"px; visibility: visible; transform: translate(").concat(r,"px, ").concat(o,"px)"))}},{key:"componentDidMount",value:function(){document.addEventListener("keyup",this.onKeyup),this.calculatePostion()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.onKeyup)}},{key:"render",value:function(){return i.a.createElement($,null,i.a.createElement("div",null,i.a.createElement("div",{className:"page-overlay",onClick:this.closePopup}),i.a.createElement("div",{className:"page-overlay-content invisible"},this.props.children)))}}]),t}(i.a.Component),X=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).emojiService=new _,n.onEmojiIconClick=n.onEmojiIconClick.bind(Object(u.a)(n)),n.closeEmoji=n.closeEmoji.bind(Object(u.a)(n)),n.addEmoji=n.addEmoji.bind(Object(u.a)(n)),n.state={isEmojiOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onEmojiIconClick",value:function(e){this.clickedTarget=e.currentTarget,this.setState({isEmojiOpen:!0})}},{key:"closeEmoji",value:function(){var e=this;this.setState({isEmojiOpen:!1},function(){e.clickedTarget=void 0,e.props.onClose&&e.props.onClose()})}},{key:"addEmoji",value:function(e){if(this.setState({isEmojiOpen:!1}),this.props.onEmojiHtmlAdded){var t=this.emojiService.convertColonsToHtml(e.colons);this.props.onEmojiHtmlAdded(t)}this.props.onEmojiColonsAdded&&this.props.onEmojiColonsAdded(e.colons)}},{key:"render",value:function(){return i.a.createElement("div",{className:"emoji-picker-root"},i.a.createElement(p.a,{trigger:i.a.createElement(v.a,{name:"smile outline",className:"icon-emoji",onClick:this.onEmojiIconClick}),content:this.props.tooltipText,inverted:!0,position:"top center",size:"tiny"}),this.state.isEmojiOpen&&i.a.createElement("div",{className:"emoji-picker-container"},i.a.createElement(Z,{clickedTarget:this.clickedTarget,onClose:this.closeEmoji},i.a.createElement(Y.a,{set:"google",data:Q,onSelect:this.addEmoji}))))}}]),t}(i.a.Component),ee=(n(485),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).apiService=new y(e),n.emojiService=new _,n.onReactionClicked=n.onReactionClicked.bind(Object(u.a)(n)),n.onEmojiColonsSelected=n.onEmojiColonsSelected.bind(Object(u.a)(n)),n.onEmojiClose=n.onEmojiClose.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onReactionClicked",value:function(e){var t=this;!0!==this.reactionClicked&&(this.reactionClicked=!0,e.users.some(function(e){return e.id===t.props.userProfile.id})?this.props.onEmojiColonsRemoved(e.emojiColons):this.props.onEmojiColonsAdded(e.emojiColons))}},{key:"onEmojiColonsSelected",value:function(e){if(!0!==this.reactionClicked){this.reactionClicked=!0;var t=this.props.reactions.find(function(t){return t.emojiColons===e});t?this.onReactionClicked(t):this.props.onEmojiColonsAdded(e)}}},{key:"onHoverMessageReactions",value:function(e){e.currentTarget.classList.add("message-reactions-hover")}},{key:"onLeaveMessageReactions",value:function(e){e.currentTarget.classList.remove("message-reactions-hover")}},{key:"onEmojiClose",value:function(){var e=document.querySelector(".message-reactions-hover");e&&e.classList.remove("message-reactions-hover")}},{key:"componentDidUpdate",value:function(e){this.props.reactions!==e.reactions&&(this.reactionClicked=!1)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"message-reactions",onMouseOver:this.onHoverMessageReactions,onMouseLeave:this.onLeaveMessageReactions},this.props.reactions.map(function(t){var n=t.users.some(function(t){return t.id===e.props.userProfile.id}),a=t.users.map(function(t){return t.id===e.props.userProfile.id?"You":t.displayName}).join(", ");return i.a.createElement("div",{key:t.id,className:"message-reaction-container"},i.a.createElement(p.a,{trigger:i.a.createElement("div",{className:"message-reaction"+(n?" message-reaction-reacted":""),onClick:function(){return e.onReactionClicked(t)}},i.a.createElement("div",{className:"message-reaction-emoji",dangerouslySetInnerHTML:{__html:e.emojiService.convertColonsToHtml(t.emojiColons)}}),i.a.createElement("div",{className:"message-reaction-user-count"},t.users.length)),content:"".concat(a," reacted with ").concat(t.emojiColons),inverted:!0,position:"top center",size:"tiny"}))}),i.a.createElement("div",{className:"message-reaction-container"},i.a.createElement("div",{className:"message-reaction message-reaction-add-emoji"},i.a.createElement(X,{onEmojiColonsAdded:this.onEmojiColonsSelected,tooltipText:"Add reaction",onClose:this.onEmojiClose}))))}}]),t}(i.a.Component)),te=(n(486),n(487),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onImageFileClick=n.onImageFileClick.bind(Object(u.a)(n)),n.onImageFileFullScreenClose=n.onImageFileFullScreenClose.bind(Object(u.a)(n)),n.state={isFullScreenModalOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onImageFileClick",value:function(){this.setState({isFullScreenModalOpen:!0})}},{key:"onImageFileFullScreenClose",value:function(){this.setState({isFullScreenModalOpen:!1})}},{key:"render",value:function(){return i.a.createElement("div",{className:"file-item-image-container"},i.a.createElement("img",{className:"file-item-image-file",src:this.props.imageUrl,onLoad:this.props.onImageLoadingFinished,onError:this.props.onImageLoadingFinished,alt:this.props.imageName,onClick:this.onImageFileClick}),this.state.isFullScreenModalOpen&&i.a.createElement($,{onClose:this.onImageFileFullScreenClose},i.a.createElement("div",{className:"full-screen-image-container"},i.a.createElement("img",{className:"full-screen-image",src:this.props.imageUrl,alt:this.props.imageName}),i.a.createElement(k,{onClose:this.onImageFileFullScreenClose}))))}}]),t}(i.a.Component));var ne=function(e){return i.a.createElement("div",{className:"message-item-url-preview-container"},e.openGraphObjects.map(function(t,n){return i.a.createElement("div",{key:n,className:"url-preview-item"},i.a.createElement("div",{className:"url-preview-item-site-name"},t.siteName),i.a.createElement("a",{href:t.url,target:"_blank",className:"url-preview-item-title"},t.title),i.a.createElement("div",{className:"url-preview-item-description"},t.description),i.a.createElement("div",{className:"url-preview-item-image"},i.a.createElement(te,Object.assign({imageUrl:t.imageUrl,imageName:t.title},e))))}))},ae=(n(488),n(489),n(490),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onShareFileFormSubmit=n.onShareFileFormSubmit.bind(Object(u.a)(n)),n.changeSelectedShareWith=n.changeSelectedShareWith.bind(Object(u.a)(n)),n.channelPrefix="channel_",n.conversationPrefix="conversation_",n.apiService=new y(e),n.state={shareWithList:[]},n.selectedShareWith=void 0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.apiService.fetch("/api/channels/forUser"),n=this.apiService.fetch("/api/conversations/recent");Promise.all([t,n]).then(function(t){var n=Object(A.a)(t,2),a=n[0],i=n[1],s=[];a.forEach(function(t){e.props.isChannel&&e.props.id===t.id||s.push({key:"".concat(e.channelPrefix).concat(t.id),text:t.name,value:"".concat(e.channelPrefix).concat(t.id)})}),i.forEach(function(t){(e.props.isChannel||e.props.id!==t.id)&&s.push({key:"".concat(e.conversationPrefix).concat(t.id),text:t.name,value:"".concat(e.conversationPrefix).concat(t.id)})}),e.setState({shareWithList:s})})}},{key:"onShareFileFormSubmit",value:function(e){var t=this;e.preventDefault();var n=this.selectedShareWith;if(n){var a,i,s=e.currentTarget.querySelector("button[type='submit']");s.classList.add("disabled-button"),n.key.startsWith("".concat(this.channelPrefix))?(a="channel",i=+n.value.substring(this.channelPrefix.length)):(a="conversation",i=+n.value.substring(this.conversationPrefix.length));var o="/api/messages/".concat(a,"/").concat(i,"/shareFile/").concat(this.props.file.id);this.apiService.fetch(o,{method:"POST"}).then(function(){t.props.onClose(),t.props.history.push("/".concat(a,"/").concat(i))}).catch(function(e){S.b.error("Share file failed: ".concat(e)),s.classList.remove("disabled-button")})}}},{key:"changeSelectedShareWith",value:function(e,t){var n=t.value,a=this.state.shareWithList.find(function(e){return e.value===n});this.selectedShareWith=a}},{key:"render",value:function(){var e=this.props.file;return i.a.createElement("div",{className:"form-container form-with-dropdown"},i.a.createElement("h1",{style:{textAlign:"center"}},"Share file"),i.a.createElement("form",{id:"shareFileForm",method:"post",onSubmit:this.onShareFileFormSubmit},i.a.createElement("p",{className:"form-description"},"Share with"),i.a.createElement(C.a,{placeholder:"Search for channel or conversation",fluid:!0,search:!0,selection:!0,options:this.state.shareWithList,onChange:this.changeSelectedShareWith}),i.a.createElement("div",{className:"file-container"},i.a.createElement("div",{className:"file-item"},i.a.createElement(v.a,{name:"file outline",size:"large"}),i.a.createElement("span",{title:e.name},e.name))),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Share")))}}]),t}(i.a.Component)),ie=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onShareFileClick=n.onShareFileClick.bind(Object(u.a)(n)),n.onCloseShareFile=n.onCloseShareFile.bind(Object(u.a)(n)),n.apiService=new y(e),n.state={isShareFileModalOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onDownloadClick",value:function(e,t){this.apiService.fetchFile("/api/messages/downloadFile/".concat(e),t).then(function(e){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}).catch(function(e){S.b.error("Download file failed: ".concat(e))})}},{key:"onShareFileClick",value:function(){this.setState({isShareFileModalOpen:!0})}},{key:"onCloseShareFile",value:function(){this.setState({isShareFileModalOpen:!1})}},{key:"render",value:function(){var e=this,t=this.props.file;return i.a.createElement("div",{className:"file-item-toolbar"},i.a.createElement(p.a,{trigger:i.a.createElement("div",{className:"file-item-toolbar-item",onClick:function(){return e.onDownloadClick(t.id,t.name)}},i.a.createElement(v.a,{name:"cloud download"})),content:"Download",inverted:!0,position:"top center",size:"tiny"}),i.a.createElement(p.a,{trigger:i.a.createElement("div",{className:"file-item-toolbar-item",onClick:this.onShareFileClick},i.a.createElement(v.a,{name:"share alternate"})),content:"Share",inverted:!0,position:"top center",size:"tiny"}),i.a.createElement("div",null,this.state.isShareFileModalOpen&&i.a.createElement(N,{onClose:this.onCloseShareFile},i.a.createElement(ae,Object.assign({file:t,onClose:this.onCloseShareFile},this.props)))))}}]),t}(i.a.Component),se=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onShareFileClick=n.onShareFileClick.bind(Object(u.a)(n)),n.onCloseShareFile=n.onCloseShareFile.bind(Object(u.a)(n)),n.onImageFileClick=n.onImageFileClick.bind(Object(u.a)(n)),n.onImageFileFullScreenClose=n.onImageFileFullScreenClose.bind(Object(u.a)(n)),n.apiService=new y(e),n.isImage=e.file.contentType.startsWith("image"),n.state={isShareFileModalOpen:!1,isFullScreenModalOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onDownloadClick",value:function(e,t){this.apiService.fetchFile("/api/messages/downloadFile/".concat(e),t).then(function(e){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}).catch(function(e){S.b.error("Download file failed: ".concat(e))})}},{key:"onShareFileClick",value:function(){this.setState({isShareFileModalOpen:!0})}},{key:"onCloseShareFile",value:function(){this.setState({isShareFileModalOpen:!1})}},{key:"onImageFileClick",value:function(){this.setState({isFullScreenModalOpen:!0})}},{key:"onImageFileFullScreenClose",value:function(){this.setState({isFullScreenModalOpen:!1})}},{key:"componentDidMount",value:function(){var e=this;this.isImage&&this.apiService.fetchFile("/api/messages/downloadFile/".concat(this.props.file.id),this.props.file.name).then(function(t){e.setState({imageUrl:t})})}},{key:"render",value:function(){var e=this.props.file;return i.a.createElement("div",{className:"content-message-file-item"},this.isImage&&this.state.imageUrl&&i.a.createElement("div",{className:"file-image-item"},i.a.createElement("div",{className:"file-image-item-name"},e.name),i.a.createElement(te,Object.assign({imageUrl:this.state.imageUrl,imageName:e.name},this.props)),i.a.createElement("div",{className:"file-item-toolbar-container"},i.a.createElement(ie,Object.assign({file:e},this.props)))),!this.isImage&&i.a.createElement("div",{className:"file-item"},i.a.createElement(v.a,{name:"file outline",size:"large"}),i.a.createElement("span",{title:e.name},e.name),i.a.createElement("div",{className:"file-item-toolbar-container"},i.a.createElement(ie,Object.assign({file:e},this.props)))))}}]),t}(i.a.Component);function oe(e){var t=e.content;if(e.edited){var n=document.createElement("template");n.innerHTML=t;var a=document.createElement("span"),s=document.createTextNode("(edited)");a.appendChild(s),a.setAttribute("class","content-edited-text"),n.content.lastChild.appendChild(a),t=n.innerHTML}return i.a.createElement("div",{dangerouslySetInnerHTML:{__html:t}})}var re=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).apiService=new y(e),n.onDeleteMessageConfirmed=n.onDeleteMessageConfirmed.bind(Object(u.a)(n)),n.onEmojiColonsAdded=n.onEmojiColonsAdded.bind(Object(u.a)(n)),n.onEmojiColonsRemoved=n.onEmojiColonsRemoved.bind(Object(u.a)(n)),n.onHoverMessageItem=n.onHoverMessageItem.bind(Object(u.a)(n)),n.onLeaveMessageItem=n.onLeaveMessageItem.bind(Object(u.a)(n)),n.removeCurrentMessageHover=n.removeCurrentMessageHover.bind(Object(u.a)(n)),n.state={isDeleteMessageConfirmOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onHoverMessageItem",value:function(e){this.removeCurrentMessageHover(),e.currentTarget.classList.add("message-hover")}},{key:"onLeaveMessageItem",value:function(e){e.currentTarget.classList.remove("message-hover")}},{key:"removeCurrentMessageHover",value:function(){var e=document.querySelector(".message-hover");e&&e.classList.remove("message-hover")}},{key:"onDeleteMessageConfirmed",value:function(e){this.setState({isDeleteMessageConfirmOpen:!1}),this.apiService.fetch("/api/messages/".concat(this.props.section,"/").concat(this.props.id,"/deleteMessage"),{method:"POST",body:JSON.stringify(e)}).catch(function(e){S.b.error("Delete message failed: ".concat(e))})}},{key:"onEmojiColonsAdded",value:function(e){this.apiService.fetch("/api/messages/".concat(this.props.section,"/").concat(this.props.id,"/addReaction/").concat(this.props.message.id),{method:"POST",body:JSON.stringify(e)}).catch(function(e){S.b.error("Add reaction failed: ".concat(e))})}},{key:"onEmojiColonsRemoved",value:function(e){this.apiService.fetch("/api/messages/".concat(this.props.section,"/").concat(this.props.id,"/removeReaction/").concat(this.props.message.id),{method:"POST",body:JSON.stringify(e)}).catch(function(e){S.b.error("Remove reaction failed: ".concat(e))})}},{key:"render",value:function(){var e=this,t=this.props.message;return i.a.createElement("div",{className:"message-item-common-container message-item-container"+(t.isConsecutiveMessage?" following-message":"")+(t.isSystemMessage?" system-message":""),key:t.id,onMouseOver:this.onHoverMessageItem,onMouseLeave:this.onLeaveMessageItem},i.a.createElement("img",{className:"user-identicon",src:t.sender.identiconPath,onClick:function(n){return e.props.onOpenUserPopup(n.currentTarget,t.sender.id)}}),i.a.createElement("div",{className:"message-item"},i.a.createElement("div",{className:"message-title"},i.a.createElement("b",{className:"message-sender-name",onClick:function(n){return e.props.onOpenUserPopup(n.currentTarget,t.sender.id)}},t.sender.displayName),i.a.createElement("span",{className:"message-time"},t.timeString)),i.a.createElement("div",{className:"message-content-container"},i.a.createElement("div",{className:"message-content-time"},i.a.createElement("span",{className:"message-time"},t.timeString)),i.a.createElement("div",{className:"message-toolbar"},i.a.createElement("div",{className:"message-toolbar-item"},i.a.createElement("div",{className:"message-toolbar-item-content"},i.a.createElement(X,{onEmojiColonsAdded:this.onEmojiColonsAdded,onClose:this.removeCurrentMessageHover,tooltipText:"Add reaction"}))),t.sender.id===this.props.userProfile.id&&!t.hasFileAttachments&&!t.isSystemMessage&&i.a.createElement("div",{className:"message-toolbar-item"},i.a.createElement(p.a,{trigger:i.a.createElement("div",{className:"message-toolbar-item-content",onClick:function(){return e.props.onEditMessageClicked(t.id)}},i.a.createElement(v.a,{name:"edit outline"})),content:"Edit message",inverted:!0,position:"top center",size:"tiny"})),t.sender.id===this.props.userProfile.id&&!t.isSystemMessage&&i.a.createElement("div",{className:"message-toolbar-item"},i.a.createElement(p.a,{trigger:i.a.createElement("div",{className:"message-toolbar-item-content",onClick:function(){return e.setState({isDeleteMessageConfirmOpen:!0})}},i.a.createElement(v.a,{name:"trash alternate outline"})),content:"Delete message",inverted:!0,position:"top center",size:"tiny"}),i.a.createElement(z.a,{open:this.state.isDeleteMessageConfirmOpen,header:"Delete message",content:"Are you sure you want to delete this message? This cannot be undone.",onCancel:function(){return e.setState({isDeleteMessageConfirmOpen:!1})},onConfirm:function(){return e.onDeleteMessageConfirmed(t.id)}}))),i.a.createElement("div",{className:"message-content"},!t.hasFileAttachments&&i.a.createElement("div",null,i.a.createElement(oe,{content:t.content,edited:t.contentEdited}),t.containsOpenGraphObjects&&i.a.createElement(ne,Object.assign({openGraphObjects:t.openGraphDtos},this.props))),t.hasFileAttachments&&i.a.createElement("div",{className:"file-container"},t.fileAttachments.map(function(t){return i.a.createElement(se,Object.assign({key:t.id,file:t},e.props))})))),t.messageReactions&&t.messageReactions.length>0&&i.a.createElement("div",{className:"message-reactions-container"},i.a.createElement(ee,Object.assign({reactions:t.messageReactions,onEmojiColonsAdded:this.onEmojiColonsAdded,onEmojiColonsRemoved:this.onEmojiColonsRemoved},this.props)))))}}]),t}(i.a.Component),le=(n(547),n(548),n(303)),ce=n(310),me=n(72),ue=n.n(me),he=function(){function e(t){Object(r.a)(this,e),this.params=t,this.quill=void 0,this.spanTagName="spanTag",this.keydownEventHandler=this.keydownEventHandler.bind(this),this.submitMessage=this.submitMessage.bind(this)}return Object(l.a)(e,[{key:"getCursorIndex",value:function(){return this.quill.selection.savedRange.index}},{key:"setCursorIndex",value:function(e){this.quill.setSelection(e,0)}},{key:"setContent",value:function(e){this.quill.root.innerHTML=e}},{key:"getSpanTagName",value:function(){return this.spanTagName}},{key:"insertText",value:function(e,t){this.quill.insertText(e,t)}},{key:"getText",value:function(){return this.quill.getText().trim()}},{key:"deleteText",value:function(e,t){this.quill.deleteText(e,t)}},{key:"insertHtml",value:function(e,t,n){this.quill.insertEmbed(e,t,n)}},{key:"unregisterEventHandlers",value:function(){document.querySelector(this.params.editorContainerSelector).removeEventListener("keydown",this.keydownEventHandler,!0);var e=document.querySelector(".ql-editor");e.removeEventListener("focus",this.params.onToggleFocus),e.removeEventListener("blur",this.params.onToggleFocus),this.quill.off("text-change",this.params.onTextChange)}},{key:"configQuill",value:function(){var e=ue.a.import("modules/clipboard"),t=ue.a.import("delta"),n=function(e){function n(){return Object(r.a)(this,n),Object(c.a)(this,Object(m.a)(n).apply(this,arguments))}return Object(h.a)(n,e),Object(l.a)(n,[{key:"convert",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;"string"===typeof e&&(this.container.innerHTML=e);var n=this.container.innerText;return this.container.innerHTML="",(new t).insert(n)}}]),n}(e);ue.a.register("modules/clipboard",n,!0);var a=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"create",value:function(e){var n=Object(ce.a)(Object(m.a)(t),"create",this).call(this,e);return n.innerHTML="".concat(e),n}}]),t}(ue.a.import("blots/embed"));a.blotName=this.spanTagName,a.tagName="span",a.className="span-tag",ue.a.register(Object(le.a)({},"formats/".concat(this.spanTagName),a))}},{key:"submitMessage",value:function(){var e=this.quill.getText().trim(),t=this.quill.root.innerHTML;this.quill.root.innerHTML="",this.params.onSubmitMessage(t,e)}},{key:"init",value:function(){var e=this;this.configQuill();var t={list:{key:"enter",shiftKey:!1,handler:function(){return e.submitMessage(),!1}}};this.quill=new ue.a(this.params.editorContainerSelector,{theme:"snow",placeholder:"Type your message...",modules:{keyboard:{bindings:t}}}),this.registerEventHandlers()}},{key:"registerEventHandlers",value:function(){this.quill.on("text-change",this.params.onTextChange);var e=document.querySelector(".ql-editor");e.addEventListener("focus",this.params.onToggleFocus),e.addEventListener("blur",this.params.onToggleFocus),document.querySelector(this.params.editorContainerSelector).addEventListener("keydown",this.keydownEventHandler,!0)}},{key:"toggleFormatChars",value:function(e){var t=this.quill.getSelection(),n=t.length;if(!(n<1)){var a,i=t.index,s=this.quill.getText(i,n);s.length>2&&s.startsWith(e)&&s.endsWith(e)?(a=s.substr(1,n-2),this.quill.deleteText(i,n),this.quill.insertText(i,a),this.quill.setSelection(i,n-2)):(a=e+s+e,this.quill.deleteText(i,n),this.quill.insertText(i,a),this.quill.setSelection(i,n+2))}}},{key:"keydownEventHandler",value:function(e){var t=!1,n="";if(e.ctrlKey||e.metaKey)switch(e.keyCode){case 66:case 98:t=!0,n="*";break;case 73:case 105:t=!0,n="_";break;case 85:case 117:t=!0}return n&&this.toggleFormatChars(n),!0!==t||(e.stopPropagation(),e.preventDefault(),!1)}}]),e}(),de=(n(549),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onMentionSelecting=n.onMentionSelecting.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onMentionSelecting",value:function(e){var t=document.querySelector(".user-mention-item.active-item");t&&t.classList.remove("active-item"),this.props.onMentionSelecting(e)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"user-mention panel"},i.a.createElement("div",{className:"user-mention-title"},i.a.createElement("div",{className:"mention-filter-name"},'People matching "@',i.a.createElement("b",null,this.props.filterName),'"'),i.a.createElement("div",{className:"mention-prompt"},i.a.createElement("span",null,i.a.createElement("b",null,"\u2191")," ",i.a.createElement("b",null,"\u2193")," to navigate"),i.a.createElement("span",null,i.a.createElement("b",null,"\u21b5")," to select"),i.a.createElement("span",null,i.a.createElement("b",null,"esc")," to dismiss"))),this.props.userList.map(function(t,n){var a=n===e.props.highlightItemIndex;return i.a.createElement("div",{key:t.id,className:"user-mention-item list-item"+(a?" active-item":""),onMouseOver:function(){e.onMentionSelecting(t.id)},onClick:function(n){n.preventDefault(),e.props.onMentionSelected(t.id)}},i.a.createElement("img",{className:"user-identicon",src:t.identiconPath}),i.a.createElement("span",{className:"user-mention-name"},t.displayName),i.a.createElement("span",{className:"user-mention-email"},t.email))}))}}]),t}(i.a.Component)),pe=n(563),ve=(n(550),function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onUploadFileFormSubmit=n.onUploadFileFormSubmit.bind(Object(u.a)(n)),n.apiService=new y(e);return n.files=n.props.files,n.files.length>3&&(S.b.warn("Maximum ".concat(3," files can be uploaded at one time")),n.files=n.files.slice(0,3)),n.state={showUploadingBar:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onUploadFileFormSubmit",value:function(e){var t=this;if(e.preventDefault(),0!==this.files.length){var n=e.currentTarget.querySelector("button[type='submit']");n.classList.add("disabled-button"),this.setState({showUploadingBar:!0});var a=new FormData;this.files.forEach(function(e){return a.append("files",e)});var i=this.props.isChannel?"/api/messages/channel/".concat(this.props.id,"/uploadFile"):"/api/messages/conversation/".concat(this.props.id,"/uploadFile");this.apiService.fetch(i,{method:"POST",body:a},!0).then(function(e){t.props.onUploaded()}).catch(function(e){S.b.error("Upload file failed: ".concat(e)),t.setState({showUploadingBar:!1}),n.classList.remove("disabled-button")})}}},{key:"render",value:function(){return i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",{style:{textAlign:"center"}},"Upload file"),i.a.createElement("form",{id:"uploadFileForm",method:"post",onSubmit:this.onUploadFileFormSubmit},i.a.createElement("p",{className:"form-description warning-text"},"There are some limitations on how many files you can upload. If you need to upload more files, please contact liefuzhangnz@gmail.com"),i.a.createElement("div",{className:"file-container"},this.files.map(function(e){return i.a.createElement("div",{key:e.name+e.lastModified,className:"file-item"},i.a.createElement(v.a,{name:"file outline",size:"large"}),i.a.createElement("span",{title:e.name},e.name))})),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Upload"),this.state.showUploadingBar&&i.a.createElement(pe.a,{percent:100,active:!0},"Uploading file")))}}]),t}(i.a.Component)),ge=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).apiService=new y(e),n.isSendingTypingMessage=!1,n.keydownEventHandler=n.keydownEventHandler.bind(Object(u.a)(n)),n.onTextChange=n.onTextChange.bind(Object(u.a)(n)),n.onMentionSelecting=n.onMentionSelecting.bind(Object(u.a)(n)),n.onMentionSelected=n.onMentionSelected.bind(Object(u.a)(n)),n.onSubmitMessage=n.onSubmitMessage.bind(Object(u.a)(n)),n.onToggleFocus=n.onToggleFocus.bind(Object(u.a)(n)),n.onFileUploaded=n.onFileUploaded.bind(Object(u.a)(n)),n.onCloseUploadFile=n.onCloseUploadFile.bind(Object(u.a)(n)),n.onUploadFileButtonClicked=n.onUploadFileButtonClicked.bind(Object(u.a)(n)),n.onMentionButtonClicked=n.onMentionButtonClicked.bind(Object(u.a)(n)),n.openMention=n.openMention.bind(Object(u.a)(n)),n.closeMention=n.closeMention.bind(Object(u.a)(n)),n.onEmojiHtmlAdded=n.onEmojiHtmlAdded.bind(Object(u.a)(n)),n.onEditorPaste=n.onEditorPaste.bind(Object(u.a)(n)),n.userList=[],n.quillService=new he({editorContainerSelector:"#".concat(n.props.containerId," #messageEditor"),onSubmitMessage:n.onSubmitMessage,onTextChange:n.onTextChange,onToggleFocus:n.onToggleFocus}),n.state={isMentionOpen:!1,mentionUserList:[],highlightMentionUserIndex:0,isUploadFileModalOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.containerElement=document.getElementById(this.props.containerId),this.quillService.init(),this.initMention(),this.registerEventHandlers(),this.fecthUsers(),this.props.isEditing&&this.populateCurrentContent()}},{key:"componentWillUnmount",value:function(){this.unregisterEventHandlers()}},{key:"componentDidUpdate",value:function(e){this.props.submitMessage!==e.submitMessage&&!0===this.props.submitMessage&&this.quillService.submitMessage()}},{key:"populateCurrentContent",value:function(){var e=this,t=this.props.message.content;/<b>|<i>|<strike>|<code>|<pre>|<blockquote>|<\/a>/.test(t)?this.apiService.fetch("/api/messages/stringifyHtml",{method:"POST",body:JSON.stringify(t)}).then(function(t){e.quillService.setContent(t)}):this.quillService.setContent(t)}},{key:"fecthUsers",value:function(){var e=this;this.apiService.fetch("/api/users").then(function(t){var n=e.props.userProfile.id;e.userList=t.filter(function(e){return e.id!==n})})}},{key:"initMention",value:function(){this.mention={mentionAtIndex:void 0,filterName:"",isSelecting:!1,isSelectionInserted:!1,isSelected:!1,mentionRegex:/<span data-user-id="([0-9]+)" class="mentioned-user">@.+?<\/span>/g}}},{key:"openMention",value:function(){var e=this;this.setState({isMentionOpen:!0},function(){document.addEventListener("click",e.closeMention)})}},{key:"closeMention",value:function(e){var t=this,n=this.containerElement.querySelector(".user-mention-container");e&&n.contains(e.target)||(this.initMention(),this.setState({isMentionOpen:!1},function(){document.removeEventListener("click",t.closeMention)}))}},{key:"onSubmitMessage",value:function(e,t){var n=this;if(t||this.mention.mentionRegex.test(e)||/<span class="emoji-container">/.test(e)){var a,i=[];for(this.mention.mentionRegex.lastIndex=0;null!==(a=this.mention.mentionRegex.exec(e));)i.push(+a[1]);this.closeMention(),this.isSendingTypingMessage=!1;var s=this.props.isEditing?"/api/messages/".concat(this.props.section,"/").concat(this.props.id,"/update/").concat(this.props.message.id):"/api/messages/".concat(this.props.section,"/").concat(this.props.id);this.apiService.fetch(s,{method:"POST",body:JSON.stringify({messageContent:e,mentionUserIds:i})}).then(function(){n.props.onMessageSubmitted&&n.props.onMessageSubmitted()}).catch(function(e){S.b.error("Send message failed: ".concat(e))})}}},{key:"onTextChange",value:function(e){var t=this;if(!this.mention.isSelecting){var n=e.ops.find(function(e){return!!e.insert}),a=e.ops.find(function(e){return!!e.delete});if(n&&n.insert&&"string"===typeof n.insert&&"@"===n.insert.trim()&&!this.state.isMentionOpen)return this.setMentionList(this.userList.slice(0,8)),this.openMention(),void(this.mention.mentionAtIndex=this.quillService.getCursorIndex()-1);if(a&&this.state.isMentionOpen&&!this.mention.filterName)return void this.onMentionFinish();if(this.state.isMentionOpen){if(this.mention.isSelectionInserted)this.onMentionFinish();else{n?this.mention.filterName+=n.insert:this.mention.filterName=this.mention.filterName.substring(0,this.mention.filterName.length-a.delete);var i=this.userList.filter(function(e){return e.displayName.toLowerCase().indexOf(t.mention.filterName.toLowerCase())>-1}).slice(0,8);this.setMentionList(i),0===i.length&&n&&""===n.insert.trim()&&this.onMentionFinish()}return}}!1===this.isSendingTypingMessage&&!this.props.isEditing&&this.quillService.getText()&&(this.isSendingTypingMessage=!0,this.sendTypingMessage(),setTimeout(function(){t.isSendingTypingMessage=!1},1e4))}},{key:"setMentionList",value:function(e){this.setState({mentionUserList:e,highlightMentionUserIndex:0})}},{key:"sendTypingMessage",value:function(){var e=this.props.isChannel?"/api/channels/notifyTyping":"/api/conversations/notifyTyping";this.apiService.fetch(e,{method:"POST",body:JSON.stringify(this.props.id)})}},{key:"formatMentionUser",value:function(e){return'<span data-user-id="'.concat(e.id,'" class="mentioned-user">@').concat(e.displayName,"</span>")}},{key:"onMentionSelecting",value:function(e){if(!this.state.isMentionOpen||!this.mention.filterName||this.mention.isSelected){this.mention.isSelecting=!0;var t=this.userList.find(function(t){return t.id===e});this.quillService.deleteText(this.mention.mentionAtIndex,1),this.quillService.insertHtml(this.mention.mentionAtIndex,this.quillService.getSpanTagName(),this.formatMentionUser(t)),this.quillService.insertText(this.mention.mentionAtIndex+1," "),this.quillService.setCursorIndex(this.mention.mentionAtIndex+2,0),this.mention.isSelecting=!1,this.mention.isSelectionInserted=!0}}},{key:"onMentionSelected",value:function(e){this.mention.isSelected=!0,this.onMentionSelecting(e),this.mention.filterName&&this.quillService.deleteText(this.mention.mentionAtIndex+2,this.mention.filterName.length),this.onMentionFinish()}},{key:"focusOnEditor",value:function(){this.containerElement.querySelector(".ql-editor").focus()}},{key:"onMentionFinish",value:function(){this.closeMention(),this.focusOnEditor()}},{key:"onMentionButtonClicked",value:function(e){this.focusOnEditor();var t=this.quillService.getCursorIndex();this.quillService.setCursorIndex(t,0),this.quillService.insertText(t,"@")}},{key:"registerEventHandlers",value:function(){this.containerElement.querySelector("#messageEditor").addEventListener("keydown",this.keydownEventHandler,!0)}},{key:"unregisterEventHandlers",value:function(){this.containerElement.querySelector("#messageEditor").removeEventListener("keydown",this.keydownEventHandler,!0),this.quillService.unregisterEventHandlers()}},{key:"onToggleFocus",value:function(){this.containerElement.querySelector(".message-box").classList.toggle("focus")}},{key:"keydownEventHandler",value:function(e){var t=!1;if(this.state.isMentionOpen&&!e.ctrlKey&&!e.shiftKey&&!e.altKey){var n=this.state.highlightMentionUserIndex;switch(e.keyCode){case 40:this.setState({highlightMentionUserIndex:n+1>this.state.mentionUserList.length-1?0:n+1}),t=!0;break;case 38:this.setState({highlightMentionUserIndex:n-1<0?this.state.mentionUserList.length-1:n-1}),t=!0;break;case 13:case 9:var a=this.state.mentionUserList[this.state.highlightMentionUserIndex];a&&(this.onMentionSelected(a.id),t=!0);break;case 27:this.onMentionFinish(),t=!0}}return!0!==t||(e.stopPropagation(),e.preventDefault(),!1)}},{key:"onEditorPaste",value:function(e){for(var t=/^image\/(gif|jpg|jpeg|tiff|png)$/i,n=e.clipboardData.items,a=0;a<n.length;a++)if(t.test(n[a].type)){var i=n[a].getAsFile();if(i)return this.openUploadFile([i]),e.stopPropagation(),void e.preventDefault()}}},{key:"onFileUploaded",value:function(e){e.currentTarget.files&&e.currentTarget.files[0]&&this.openUploadFile(e.currentTarget.files)}},{key:"openUploadFile",value:function(e){this.uploadFiles=e,this.setState({isUploadFileModalOpen:!0})}},{key:"onCloseUploadFile",value:function(){this.containerElement.querySelector("#uploadFile").value="",this.setState({isUploadFileModalOpen:!1})}},{key:"onUploadFileButtonClicked",value:function(){this.containerElement.querySelector("#uploadFile").click()}},{key:"onEmojiHtmlAdded",value:function(e){var t=this.quillService.getCursorIndex();this.quillService.insertHtml(t,this.quillService.getSpanTagName(),'<span class="emoji-container">'.concat(e,"</span>")),this.quillService.insertText(t+1," "),this.quillService.setCursorIndex(t+2,0),this.focusOnEditor()}},{key:"render",value:function(){return i.a.createElement("div",{className:this.props.isEditing?"editing-editor":""},i.a.createElement("form",{id:"messageForm",method:"post"},this.state.isMentionOpen&&i.a.createElement("div",{className:"user-mention-container"},i.a.createElement(de,{userList:this.state.mentionUserList,onMentionSelecting:this.onMentionSelecting,onMentionSelected:this.onMentionSelected,highlightItemIndex:this.state.highlightMentionUserIndex,filterName:this.mention.filterName})),i.a.createElement("div",{className:"message-box"},i.a.createElement("div",{className:"message-editor-container"},i.a.createElement("div",{id:"messageEditor",onPaste:this.onEditorPaste})),i.a.createElement("div",{className:"message-box-buttons"},i.a.createElement("div",{className:"message-box-button"},i.a.createElement("div",{onClick:this.onMentionButtonClicked},i.a.createElement(p.a,{trigger:i.a.createElement(v.a,{name:"at",className:"icon-mention"}),content:"Mention user",inverted:!0,position:"top center",size:"tiny"}))),i.a.createElement("div",{className:"message-box-button"},i.a.createElement("input",{id:"uploadFile",type:"file",multiple:!0,onChange:this.onFileUploaded}),i.a.createElement("div",{onClick:this.onUploadFileButtonClicked},i.a.createElement(p.a,{trigger:i.a.createElement(v.a,{name:"paperclip",className:"icon-paperclip"}),content:"Send file",inverted:!0,position:"top center",size:"tiny"})),this.state.isUploadFileModalOpen&&i.a.createElement(N,{onClose:this.onCloseUploadFile},i.a.createElement(ve,Object.assign({files:Array.from(this.uploadFiles),onUploaded:this.onCloseUploadFile},this.props)))),i.a.createElement("div",{className:"message-box-button"},i.a.createElement(X,{onEmojiHtmlAdded:this.onEmojiHtmlAdded,tooltipText:"Add emoji"}))))))}}]),t}(i.a.Component),fe=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).apiService=new y(e),n.state={saveChangesClicked:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"message-item-common-container message-item-edit-container"},i.a.createElement("img",{className:"user-identicon",src:this.props.userProfile.identiconPath}),i.a.createElement("div",{className:"message-item-editor-container"},i.a.createElement("div",{id:"messageItemEditor"},i.a.createElement(ge,Object.assign({containerId:"messageItemEditor",isEditing:!0,onMessageSubmitted:this.props.onClose,submitMessage:this.state.saveChangesClicked},this.props))),i.a.createElement("div",{className:"message-item-editor-buttons"},i.a.createElement("button",{className:"btn white-btn "+(this.state.saveChangesClicked?"disabled-button":""),onClick:this.props.onClose},"Cancel"),i.a.createElement("button",{className:"btn "+(this.state.saveChangesClicked?"disabled-button":""),onClick:function(){return e.setState({saveChangesClicked:!0})}},"Save Changes"))))}}]),t}(i.a.Component),be=(n(270),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).dto=e.messageChannelDescriptionDto,n.createdBy=n.dto.createdByUser.id===e.userProfile.id?"you":n.dto.createdByUser.displayName,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"content-message-description"},i.a.createElement("div",{className:"message-description-name"},this.dto.messageChannelName),i.a.createElement("p",null,i.a.createElement("span",null,"This channel has been created by ",this.createdBy," on"," ",this.dto.createdDateString,". This is the very beginning of the"," ",i.a.createElement("b",null,this.dto.messageChannelName)," channel.")))}}]),t}(i.a.Component)),Ce=function(e){function t(e){return Object(r.a)(this,t),Object(c.a)(this,Object(m.a)(t).call(this,e))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.isSelfConversation?this.props.userList:this.props.userList.filter(function(t){return t.id!==e.props.userProfile.id});return i.a.createElement("div",{className:"content-message-description"},i.a.createElement("div",{className:"user-identicons"},t.map(function(e){return i.a.createElement("img",{key:e.id,"data-user-id":e.id,className:"user-identicon mentioned-user",src:e.identiconPath})})),i.a.createElement("p",null,this.props.isSelfConversation&&i.a.createElement("span",null,i.a.createElement("b",null,"This is your own space!")," Feel free to play around, draft or simply keep things handy."),!this.props.isSelfConversation&&i.a.createElement("span",null,"This is the very beginnning of the direct message history between you and"," ",this.props.userList.filter(function(t){return t.id!==e.props.userProfile.id}).map(function(e,t){return i.a.createElement("span",{key:e.id},0!==t?", ":"",i.a.createElement("span",{"data-user-id":e.id,className:"mentioned-user"},"@",e.displayName))}),". Let's chat!")))}}]),t}(i.a.Component),Se=n(188),Ee=n.n(Se),ye=function(){function e(){Object(r.a)(this,e),this.CHANGE_TYPE={ADDED:1,EDITED:2,DELETED:3}}return Object(l.a)(e,[{key:"setIsConsecutiveMessage",value:function(e,t){if(e.senderId!==t.senderId||t.isSystemMessage)e.isConsecutiveMessage=!1;else{var n=Ee()(e.timeString,"h:mm A"),a=Ee()(t.timeString,"h:mm A");e.isConsecutiveMessage=n-a<=18e4}}},{key:"mergeMessageGroups",value:function(e,t){var n=[];if(t.length>0&&e.length>0&&e[e.length-1].dateString===t[0].dateString){var a=t[0].messages,i=e[e.length-1].messages;this.setIsConsecutiveMessage(a[0],i[i.length-1]),t[0].messages=i.concat(a),n=e.slice(0,e.length-1).concat(t)}else n=e.concat(t);return n}},{key:"handleEditedMessageItem",value:function(e,t){var n=e.messages[0],a=t.find(function(t){return t.dateString===e.dateString});if(a){var i=a.messages.findIndex(function(e){return e.id===n.id});if(!(i<0))return n.isConsecutiveMessage=a.messages[i].isConsecutiveMessage,a.messages[i]=n,t}}},{key:"handleDeletedMessageItem",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var r=s.value,l=r.messages.findIndex(function(t){return t.id===e});if(!(l<0)){if(l>0&&l<r.messages.length-1?this.setIsConsecutiveMessage(r.messages[l+1],r.messages[l-1]):0===l&&l<r.messages.length-1&&(r.messages[l+1].isConsecutiveMessage=!1),r.messages.splice(l,1),0===r.messages.length){var c=t.indexOf(r);t.splice(c,1)}return t}}}catch(m){a=!0,i=m}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}}]),e}(),Oe=function(){function e(t){Object(r.a)(this,e),this.params=t,this.lastGroupIndex=-1,this.offsetTops=[],this.messageGroupAnchors=[],this.scrolled=!1,this.onScrollHandler=this.onScrollHandler.bind(this),this.calculateMessageGroupOffsetTops=this.calculateMessageGroupOffsetTops.bind(this),this.calculateCurrentGroup=this.calculateCurrentGroup.bind(this)}return Object(l.a)(e,[{key:"reset",value:function(){this.scrollableElement=document.querySelector(this.params.scrollableElementSelector),this.scrollableElement.onscroll=this.onScrollHandler,this.lastGroupIndex=-1,this.calculateMessageGroupOffsetTops(),this.calculateCurrentGroup()}},{key:"onScrollHandler",value:function(){0===this.scrollableElement.scrollTop&&(this.savedScrollHeight=this.scrollableElement.scrollHeight,this.params.onScrollToTop()),this.calculateCurrentGroup()}},{key:"resumeScrollPosition",value:function(){this.savedScrollHeight&&(this.scrollableElement.scrollTop=this.scrollableElement.scrollHeight-this.savedScrollHeight,this.savedScrollHeight=void 0)}},{key:"calculateMessageGroupOffsetTops",value:function(){this.messageGroupAnchors=Array.from(this.scrollableElement.querySelectorAll(this.params.anchorSelector)),this.offsetTops=this.messageGroupAnchors.map(function(e){return e.offsetTop})}},{key:"calculateCurrentGroup",value:function(){if(0!==this.messageGroupAnchors.length){for(var e=this.messageGroupAnchors[0].offsetHeight/2,t=-1,n=this.lastGroupIndex-1,a=n=n<0?0:n;a<this.offsetTops.length&&!(this.scrollableElement.scrollTop<this.offsetTops[a]+e);a++)t=a;if(this.lastGroupIndex!==t){var i=this.scrollableElement.querySelector(".".concat(this.params.stickyItemClassName));i&&i.classList.remove(this.params.stickyItemClassName),-1!==t&&this.messageGroupAnchors[t].classList.add(this.params.stickyItemClassName),this.lastGroupIndex=t}}}},{key:"scrollToBottom",value:function(){this.scrollableElement||(this.scrollableElement=document.querySelector(this.params.scrollableElementSelector)),this.scrollableElement.scrollTop=this.scrollableElement.scrollHeight}},{key:"isCloseToBottom",value:function(){this.scrollableElement||(this.scrollableElement=document.querySelector(this.params.scrollableElementSelector));return this.scrollableElement.scrollTop+window.innerHeight>this.scrollableElement.scrollHeight+80}}]),e}(),ke=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).fetchHistory=n.fetchHistory.bind(Object(u.a)(n)),n.loadMoreHistory=n.loadMoreHistory.bind(Object(u.a)(n)),n.onChannelMessageItemChange=n.onChannelMessageItemChange.bind(Object(u.a)(n)),n.onConversationMessageItemChange=n.onConversationMessageItemChange.bind(Object(u.a)(n)),n.onEditMessageClicked=n.onEditMessageClicked.bind(Object(u.a)(n)),n.onCloseEditingMessage=n.onCloseEditingMessage.bind(Object(u.a)(n)),n.onScrollToTop=n.onScrollToTop.bind(Object(u.a)(n)),n.onImageLoadingFinished=n.onImageLoadingFinished.bind(Object(u.a)(n)),n.onMentionedUserClick=n.onMentionedUserClick.bind(Object(u.a)(n)),n.apiService=new y(e),n.mesageChangeService=new ye,n.messageScrollService=new Oe({scrollableElementSelector:".message-container .simplebar-content-wrapper",anchorSelector:".message-group-anchor",stickyItemClassName:"sticky-on-top",onScrollToTop:n.onScrollToTop}),e.hubConnection&&(e.hubConnection.on("ChannelMessageItemChanged",n.onChannelMessageItemChange),e.hubConnection.on("ConversationMessageItemChanged",n.onConversationMessageItemChange)),n.resetMessage(),n.state={messageGroups:[],editingMessageId:void 0},n.scrollDetector={},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onScrollToTop",value:function(){this.areAllPagesLoaded||this.isFetchingHistory||this.loadMoreHistory()}},{key:"resetMessage",value:function(){this.areAllPagesLoaded=!1,this.isFetchingHistory=!1,this.isFetchingSingleMessage=!1,this.resetLoadImage()}},{key:"loadMoreHistory",value:function(){this.fetchHistory(!0)}},{key:"fetchHistory",value:function(e){var t=this;this.isFetchingHistory=!0;var n,a=this.props.section,i=this.props.id;if(this.state.messageGroups.length>0){var s=this.state.messageGroups[0].messages[0].id;n="/api/messages/".concat(a,"/").concat(i,"/").concat(s)}else n="/api/messages/".concat(a,"/").concat(i);return this.apiService.fetch(n).then(function(n){if(t.isFetchingHistory&&a===t.props.section&&i===t.props.id){t.areAllPagesLoaded=n.allMessagesLoaded,t.setNewImageFileCount(n.messageGroupDtos);var s=t.mesageChangeService.mergeMessageGroups(n.messageGroupDtos,t.state.messageGroups);e||(t.messageChannelDescriptionDto=n.messageChannelDescriptionDto),t.updateMessageGroups(s,function(){e?t.messageScrollService.resumeScrollPosition():(t.messageScrollService.scrollToBottom(),t.props.onFinishLoading())})}}).finally(function(){t.isFetchingHistory=!1})}},{key:"fetchSingleMessage",value:function(e){return this.apiService.fetch("/api/messages/".concat(this.props.section,"/").concat(this.props.id,"/singleMessage/").concat(e))}},{key:"handleMessageItemChange",value:function(e,t){switch(e){case this.mesageChangeService.CHANGE_TYPE.ADDED:this.handleAddedMessageItem(t);break;case this.mesageChangeService.CHANGE_TYPE.EDITED:this.handleEditedMessageItem(t);break;case this.mesageChangeService.CHANGE_TYPE.DELETED:this.handleDeletedMessageItem(t)}}},{key:"handleAddedMessageItem",value:function(e){var t=this;this.isFetchingSingleMessage=!0,this.fetchSingleMessage(e).then(function(e){if(t.isFetchingSingleMessage){t.setNewImageFileCount([e]);e.messages[0];var n=t.mesageChangeService.mergeMessageGroups(t.state.messageGroups,[e]),a=t.messageScrollService.isCloseToBottom();t.updateMessageGroups(n,function(){a&&t.messageScrollService.scrollToBottom()})}}).finally(function(){t.isFetchingSingleMessage=!1})}},{key:"handleEditedMessageItem",value:function(e){var t=this;this.isFetchingSingleMessage=!0,this.fetchSingleMessage(e).then(function(e){if(t.isFetchingSingleMessage){var n=t.mesageChangeService.handleEditedMessageItem(e,t.state.messageGroups);n&&t.updateMessageGroups(n)}}).finally(function(){t.isFetchingSingleMessage=!1})}},{key:"handleDeletedMessageItem",value:function(e){var t=this.mesageChangeService.handleDeletedMessageItem(e,this.state.messageGroups);t&&this.updateMessageGroups(t)}},{key:"onChannelMessageItemChange",value:function(e,t,n){"channel"===this.props.section&&this.props.id===e&&this.handleMessageItemChange(t,n)}},{key:"onConversationMessageItemChange",value:function(e,t,n){"conversation"===this.props.section&&this.props.id===e&&this.handleMessageItemChange(t,n)}},{key:"onEditMessageClicked",value:function(e){this.setState({editingMessageId:e})}},{key:"onCloseEditingMessage",value:function(){this.setState({editingMessageId:void 0})}},{key:"updateMessageGroups",value:function(e,t){var n=this;this.setState({messageGroups:e},function(){if(t&&n.loadImage.imagesLoadedCallbacks.push(t),n.loadImage.loadedImageCount===n.loadImage.imageFileCount)n.finishLoading();else{n.imageLoadTimeout=setTimeout(function(){n.finishLoading()},5e3)}})}},{key:"setNewImageFileCount",value:function(e){var t=this;e&&e.forEach(function(e){e.messages.filter(function(e){return e.hasFileAttachments}).forEach(function(e){e.fileAttachments.forEach(function(e){e.contentType.startsWith("image")&&t.loadImage.imageFileCount++})}),e.messages.filter(function(e){return e.containsOpenGraphObjects}).forEach(function(e){t.loadImage.imageFileCount+=e.openGraphImageCount})})}},{key:"onImageLoadingFinished",value:function(){this.loadImage.loadedImageCount++,this.loadImage.loadedImageCount===this.loadImage.imageFileCount&&(this.imageLoadTimeout&&clearTimeout(this.imageLoadTimeout),this.finishLoading())}},{key:"finishLoading",value:function(){this.state.messageGroups.length>0&&this.messageScrollService.reset();var e=this.loadImage.imagesLoadedCallbacks;if(this.resetLoadImage(),e){var t=!0,n=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){(0,i.value)()}}catch(o){n=!0,a=o}finally{try{t||null==s.return||s.return()}finally{if(n)throw a}}}}},{key:"resetLoadImage",value:function(){this.loadImage={imageFileCount:0,loadedImageCount:0,imagesLoadedCallbacks:[]}}},{key:"onMentionedUserClick",value:function(e){if(e.target&&e.target.classList.contains("mentioned-user")){var t=e.target.getAttribute("data-user-id");this.props.onOpenUserPopup(e.target,t)}}},{key:"componentDidMount",value:function(){this.fetchHistory(!1),document.querySelector(".message-container").addEventListener("click",this.onMentionedUserClick)}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.section===e.section&&this.props.id===e.id||(this.resetMessage(),this.updateMessageGroups([],function(){return t.fetchHistory(!1)}))}},{key:"componentWillUnmount",value:function(){document.querySelector(".message-container").removeEventListener("click",this.onMentionedUserClick)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"message-container"},i.a.createElement(j.a,{className:"message-scrollable"},this.areAllPagesLoaded&&i.a.createElement("div",{className:"message-group message-content-description"},i.a.createElement("div",{className:"message-group-anchor"}),this.props.isChannel?i.a.createElement(be,{messageChannelDescriptionDto:this.messageChannelDescriptionDto,userProfile:this.props.userProfile}):this.props.messageChannelUserList&&this.props.messageChannelUserList.length>0&&i.a.createElement(Ce,{userList:this.props.messageChannelUserList,userProfile:this.props.userProfile,isSelfConversation:this.messageChannelDescriptionDto.isSelfConversation})),this.state.messageGroups.map(function(t,n){return i.a.createElement("div",{key:t.dateString,className:"message-group"},i.a.createElement("div",{className:"message-group-anchor"}),i.a.createElement("div",{className:"message-group-header-container"},i.a.createElement("div",{className:"message-group-header horizontal-divider"},i.a.createElement("span",null,t.dateString))),0===n&&!e.areAllPagesLoaded&&i.a.createElement("div",{className:"message-load-history"},"Loading history..."),t.messages.map(function(t){return i.a.createElement("div",{key:t.id},e.state.editingMessageId!==t.id&&i.a.createElement(re,Object.assign({message:t,onEditMessageClicked:e.onEditMessageClicked,onImageLoadingFinished:e.onImageLoadingFinished,onOpenUserPopup:e.props.onOpenUserPopup},e.props)),e.state.editingMessageId===t.id&&i.a.createElement(fe,Object.assign({className:"content-message-item-container",message:t,onClose:e.onCloseEditingMessage},e.props)))}))})))}}]),t}(i.a.Component),je=(n(552),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).authService=new M(e),n.onOtherUserTyping=n.onOtherUserTyping.bind(Object(u.a)(n)),n.onOtherUserFinishedTyping=n.onOtherUserFinishedTyping.bind(Object(u.a)(n)),e.hubConnection&&(e.hubConnection.on("UserTyping",n.onOtherUserTyping),e.hubConnection.on("UserFinishedTyping",n.onOtherUserFinishedTyping)),n.otherTypingNames=[],n.state={showOtherTypingInfo:!1,otherTypingUserName:void 0},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.isChannel===e.isChannel&&this.props.id===e.id||(this.otherTypingNames=[],this.toggleOtherTypingInfo(!1))}},{key:"toggleOtherTypingInfo",value:function(e){var t=this.otherTypingNames.length>2?"Multiple users":this.otherTypingNames.join(", ");this.setState({showOtherTypingInfo:e,otherTypingUserName:t})}},{key:"onOtherUserTyping",value:function(e,t,n){var a=this;t===this.props.isChannel&&n===this.props.id&&(this.addTypingName(e),setTimeout(function(){a.removeTypingName(e)},1e4))}},{key:"onOtherUserFinishedTyping",value:function(e,t,n){t===this.props.isChannel&&n===this.props.id&&this.removeTypingName(e)}},{key:"addTypingName",value:function(e){this.otherTypingNames.indexOf(e)<0&&(this.otherTypingNames.push(e),this.toggleOtherTypingInfo(!0))}},{key:"removeTypingName",value:function(e){var t=this.otherTypingNames.indexOf(e);t>-1&&(this.otherTypingNames.splice(t,1),this.toggleOtherTypingInfo(this.otherTypingNames.length>0))}},{key:"render",value:function(){return i.a.createElement("div",{className:"footer"},i.a.createElement("div",{id:"footerEditor"},i.a.createElement(ge,Object.assign({containerId:"footerEditor"},this.props))),this.state.showOtherTypingInfo&&i.a.createElement("div",{className:"message-typing-info"},i.a.createElement("span",null,this.state.otherTypingUserName)," ",this.otherTypingNames.length>1?"are":"is"," typing"),i.a.createElement("div",{className:"message-prompt"},i.a.createElement("div",null,i.a.createElement("span",null,i.a.createElement("b",null,"*bold*")),i.a.createElement("span",{className:"grey-background"},"`code`"),i.a.createElement("span",{className:"grey-background"},"```preformatted```"),i.a.createElement("span",null,i.a.createElement("i",null,"_italics_")),i.a.createElement("span",null,"~strike~"),i.a.createElement("span",null,">quote"))))}}]),t}(i.a.Component)),Ne=(n(553),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).startConversation=n.startConversation.bind(Object(u.a)(n)),n.apiService=new y(e),n.state={userRealtimeStatusLoaded:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"startConversation",value:function(){var e=this;this.apiService.fetch("/api/conversations/start",{method:"POST",body:JSON.stringify([this.props.user.id])}).then(function(t){e.props.onClose(),e.props.history.push("/conversation/".concat(t))}).catch(function(e){S.b.error("Start conversation failed: ".concat(e))})}},{key:"componentDidMount",value:function(){var e=this;this.apiService.fetch("/api/users/".concat(this.props.user.id,"/onlineStatus")).then(function(t){e.isUserOnline=t,e.setState({userRealtimeStatusLoaded:!0})})}},{key:"render",value:function(){var e=this.props.user;return i.a.createElement(Z,{clickedTarget:this.props.clickedTarget,onClose:this.props.onClose},i.a.createElement("div",{className:"user-popup panel"},i.a.createElement("div",{className:"user-popup-header"},i.a.createElement("img",{className:"user-identicon",src:e.identiconPath})),i.a.createElement("div",{className:"user-popup-body"},i.a.createElement("div",{className:"user-popup-user-info"},i.a.createElement("div",{className:"user-popup-user-name"},i.a.createElement("b",null,e.displayName),this.state.userRealtimeStatusLoaded&&this.isUserOnline&&i.a.createElement("span",{className:"user-realtime-status",title:"active"},i.a.createElement("span",{className:"user-realtime-status-circle"})),this.state.userRealtimeStatusLoaded&&!this.isUserOnline&&i.a.createElement("span",{className:"user-realtime-status user-offline",title:"away"},i.a.createElement("span",{className:"user-realtime-status-circle"}))),i.a.createElement("div",null,"Email: ",e.email),e.phoneNumber&&i.a.createElement("div",null,"Phone: ",e.phoneNumber)),i.a.createElement("div",{className:"user-popup-list-section"},i.a.createElement("div",{className:"dropdown-section"},i.a.createElement("ul",null,i.a.createElement("li",{onClick:this.startConversation},"Direct message")))))))}}]),t}(i.a.Component)),Me=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).onFinishLoading=n.onFinishLoading.bind(Object(u.a)(n)),n.onOpenUserPopup=n.onOpenUserPopup.bind(Object(u.a)(n)),n.onUserPopupClose=n.onUserPopupClose.bind(Object(u.a)(n)),n.apiService=new y(e),e.hubConnection&&e.hubConnection.on("ConversationUserListChanged",function(){return n.fetchUsers()}),n.state={isPageLoading:!0,messageChannelUserList:[],isUserPopupOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"fetchUsers",value:function(){var e=this,t=this.props.isChannel?"/api/channels/".concat(this.props.id,"/users"):"/api/conversations/".concat(this.props.id,"/users");this.apiService.fetch(t).then(function(t){return e.setState({messageChannelUserList:t})})}},{key:"onUserPopupClose",value:function(){this.popupClickedTarget=void 0,this.popupUser=void 0,this.setState({isUserPopupOpen:!1})}},{key:"onOpenUserPopup",value:function(e,t){var n=this,a=this.state.messageChannelUserList.find(function(e){return e.id===t});a?this.openUserPopup(e,a):this.apiService.fetch("/api/users/".concat(t)).then(function(t){t&&n.openUserPopup(e,t)})}},{key:"openUserPopup",value:function(e,t){this.popupClickedTarget=e,this.popupUser=t,this.setState({isUserPopupOpen:!0})}},{key:"componentDidMount",value:function(){this.fetchUsers()}},{key:"componentDidUpdate",value:function(e){this.props.isChannel===e.isChannel&&this.props.id===e.id||this.fetchUsers()}},{key:"onFinishLoading",value:function(){this.setState({isPageLoading:!1})}},{key:"render",value:function(){return i.a.createElement("div",{id:"content"},this.state.isPageLoading&&i.a.createElement(I.a,null,i.a.createElement(L.a,{active:!0},"Loading"),i.a.createElement(T.a,{src:"https://react.semantic-ui.com/images/wireframe/short-paragraph.png"}),i.a.createElement(T.a,{src:"https://react.semantic-ui.com/images/wireframe/short-paragraph.png"})),i.a.createElement(V,Object.assign({messageChannelUserList:this.state.messageChannelUserList,onOpenUserPopup:this.onOpenUserPopup},this.props)),i.a.createElement(ke,Object.assign({messageChannelUserList:this.state.messageChannelUserList,onFinishLoading:this.onFinishLoading,onOpenUserPopup:this.onOpenUserPopup},this.props)),i.a.createElement(je,{isChannel:this.props.isChannel,section:this.props.section,id:this.props.id,hubConnection:this.props.hubConnection,userProfile:this.props.userProfile}),this.state.isUserPopupOpen&&i.a.createElement(Ne,Object.assign({user:this.popupUser,clickedTarget:this.popupClickedTarget,onClose:this.onUserPopupClose},this.props)))}}]),t}(i.a.Component),we=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).isPulseSignalJustSent=!1,n.profileService=new E,n.apiService=new y(e),n.connection=(new D.a).withUrl("http://localhost:58314/chatHub/",{accessTokenFactory:function(){return n.profileService.getToken()}}).build(),n.connection.start().catch(function(e){return console.error(e.toString())}),n.onUserSessionDataChange=n.onUserSessionDataChange.bind(Object(u.a)(n)),n.onProfileUpdated=n.onProfileUpdated.bind(Object(u.a)(n)),n.sendPulseSignal=n.sendPulseSignal.bind(Object(u.a)(n)),n.state={savedActiveSidebarItem:void 0,userStatus:void 0,userProfile:n.profileService.getProfile(),userSessionDataLoaded:!1},n.sendPulseSignal(),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onUserSessionDataChange",value:function(){var e=this;this.apiService.fetch("/api/app/userSessionData").then(function(t){t&&e.setState({savedActiveSidebarItem:t.activeSidebarItem,userStatus:t.userStatus,userSessionDataLoaded:!0})})}},{key:"onProfileUpdated",value:function(){var e=this;this.apiService.fetch("/api/identity/userProfile").then(function(t){t&&(e.profileService.setProfile(t),e.setState({userProfile:t}))})}},{key:"sendPulseSignal",value:function(){var e=this;this.isPulseSignalJustSent||(this.isPulseSignalJustSent=!0,this.apiService.fetch("/api/app/userPulseSignal",{method:"POST"}),setTimeout(function(){e.isPulseSignalJustSent=!1},3e4))}},{key:"componentDidMount",value:function(){this.onUserSessionDataChange()}},{key:"render",value:function(){var e=this.props.match.params,t=e.section||(this.state.savedActiveSidebarItem&&!this.state.savedActiveSidebarItem.isChannel?"conversation":"channel"),n="channel"===t,a=+e.id||(this.state.savedActiveSidebarItem&&this.state.savedActiveSidebarItem.itemId?this.state.savedActiveSidebarItem.itemId:this.state.userProfile.defaultChannelId);return i.a.createElement("div",{className:"main-page-container",onClick:this.sendPulseSignal},this.state.userSessionDataLoaded&&i.a.createElement("div",{id:"mainPage"},i.a.createElement(U,Object.assign({isChannel:n,id:a,hubConnection:this.connection,userProfile:this.state.userProfile},this.props)),i.a.createElement(Me,Object.assign({isChannel:n,id:a,section:t,hubConnection:this.connection,onProfileUpdated:this.onProfileUpdated,onUserSessionDataChange:this.onUserSessionDataChange,userProfile:this.state.userProfile,userStatus:this.state.userStatus},this.props))))}}]),t}(i.a.Component),Pe=(n(554),n(174),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).authService=new M(e),n.apiService=new y(e),n.onAccountFormSubmit=n.onAccountFormSubmit.bind(Object(u.a)(n)),n.onWorkspaceFormSubmit=n.onWorkspaceFormSubmit.bind(Object(u.a)(n)),n.onForgotPasswordFormSubmit=n.onForgotPasswordFormSubmit.bind(Object(u.a)(n)),n.onOwnerAccountFormSubmit=n.onOwnerAccountFormSubmit.bind(Object(u.a)(n)),n.onPasswordChange=n.onPasswordChange.bind(Object(u.a)(n)),n.createdWorkspaceName="",n.createdWorkspaceOwnerEmail="",n.createdWorkspaceOwnerPassword="",n.resetEmail="",n.state={isLoginFormVisible:!0,isForgotPasswordFormVisible:!1,isForgotPasswordConfirmationFormVisible:!1,isWorkspaceFormVisible:!1,isOwnerLoginFormVisible:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onAccountFormSubmit",value:function(e){e.preventDefault();var t=e.target.elements.email.value,n=e.target.elements.password.value;if(t&&n){var a=e.currentTarget.querySelector("button[type='submit']");a.classList.add("disabled-button"),this.authService.login(t,n).catch(function(e){a.classList.remove("disabled-button")})}}},{key:"onForgotPasswordFormSubmit",value:function(e){var t=this;e.preventDefault();var n=e.target.elements.email.value;if(n){var a=e.currentTarget.querySelector("button[type='submit']");a.classList.add("disabled-button"),this.apiService.fetch("/api/users/forgotPassword",{method:"POST",body:JSON.stringify(n)},!1,!0).then(function(){t.resetEmail=n,t.setState({isForgotPasswordFormVisible:!1,isForgotPasswordConfirmationFormVisible:!0})}).catch(function(e){S.b.error("Send reset link failed: ".concat(e)),a.classList.remove("disabled-button")})}}},{key:"onWorkspaceFormSubmit",value:function(e){var t=this;e.preventDefault();var n=e.target.elements.email.value,a=e.target.elements.password.value,i=e.target.elements.workspace.value,s=e.target.elements.displayName.value;if(n&&a&&i){var o=e.currentTarget.querySelector("button[type='submit']");o.classList.add("disabled-button"),this.apiService.fetch("/api/workspaces/register",{method:"POST",body:JSON.stringify({email:n,password:a,workspaceName:i,displayName:s})},!1,!0).then(function(){t.createdWorkspaceName=i,t.createdWorkspaceOwnerEmail=n,t.createdWorkspaceOwnerPassword=a,t.setState({isWorkspaceFormVisible:!1,isOwnerLoginFormVisible:!0})}).catch(function(e){S.b.error("Create workspace failed: ".concat(e)),o.classList.remove("disabled-button")})}}},{key:"onOwnerAccountFormSubmit",value:function(e){e.preventDefault();var t=e.currentTarget.querySelector("button[type='submit']");t.classList.add("disabled-button"),this.authService.login(this.createdWorkspaceOwnerEmail,this.createdWorkspaceOwnerPassword).catch(function(e){t.classList.remove("disabled-button")})}},{key:"onPasswordChange",value:function(){var e=document.querySelector("#workspace input[name='password']"),t=document.querySelector("#workspace input[name='confirmPassword']");e.value!==t.value?t.setCustomValidity("Passwords don't match"):t.setCustomValidity("")}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"login-page"},this.state.isLoginFormVisible&&i.a.createElement("div",{id:"loginContainer",className:"login-container panel"},i.a.createElement("section",null,i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",null,"Login to your workspace"),i.a.createElement("form",{method:"post",onSubmit:this.onAccountFormSubmit},i.a.createElement("p",{className:"form-description"},"Enter email address and password to log in."),i.a.createElement("input",{className:"form-control",name:"email",type:"email",placeholder:"Email",required:!0}),i.a.createElement("input",{className:"form-control",name:"password",type:"password",placeholder:"Password",minLength:"6",required:!0}),i.a.createElement("p",{className:"demo-user"},"Demo User: ichat.test.user@gmail.com",i.a.createElement("br",null),"Password: ichattest"),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Log in"),i.a.createElement("div",{className:"forgot-password"},i.a.createElement("a",{onClick:function(){return e.setState({isLoginFormVisible:!1,isForgotPasswordFormVisible:!0})}},"Forgot your password?"))))),i.a.createElement("div",{className:"horizontal-divider"},i.a.createElement("span",null,"or")),i.a.createElement("section",null,i.a.createElement("button",{className:"btn white-btn",onClick:function(){return e.setState({isLoginFormVisible:!1,isWorkspaceFormVisible:!0})}},"Create New WorkSpace"))),this.state.isForgotPasswordFormVisible&&i.a.createElement("div",{className:"login-container panel"},i.a.createElement(k,{onClose:function(){return e.setState({isLoginFormVisible:!0,isForgotPasswordFormVisible:!1})}}),i.a.createElement("section",null,i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",null,"Reset password"),i.a.createElement("form",{method:"post",onSubmit:this.onForgotPasswordFormSubmit},i.a.createElement("p",{className:"form-description"},"Enter your registered email address to reset password."),i.a.createElement("input",{className:"form-control",name:"email",type:"email",placeholder:"Email",required:!0}),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Send reset link"))))),this.state.isForgotPasswordConfirmationFormVisible&&i.a.createElement("div",{className:"login-container panel"},i.a.createElement("section",null,i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",null,"Email sent!"),i.a.createElement("form",null,i.a.createElement("p",{className:"form-description"},"Check your ",i.a.createElement("b",null,this.resetEmail)," inbox to reset your password."))))),this.state.isWorkspaceFormVisible&&i.a.createElement("div",{className:"login-container panel"},i.a.createElement(k,{onClose:function(){return e.setState({isLoginFormVisible:!0,isWorkspaceFormVisible:!1})}}),i.a.createElement("section",null,i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",null,"Create a new workspace"),i.a.createElement("form",{id:"workspace",method:"post",onSubmit:this.onWorkspaceFormSubmit},i.a.createElement("p",{className:"form-description"},"Enter details to create workspace."),i.a.createElement("input",{className:"form-control",name:"workspace",type:"text",placeholder:"Workspace Name",pattern:"[0-9A-Za-z_]*",title:"Workspace name can only contain numbers, letters and underscore.",required:!0}),i.a.createElement("input",{className:"form-control",name:"email",type:"email",placeholder:"Your Email",required:!0}),i.a.createElement("input",{className:"form-control",name:"password",type:"password",placeholder:"Your Password",minLength:"6",onInput:this.onPasswordChange,required:!0}),i.a.createElement("input",{className:"form-control",name:"confirmPassword",type:"password",placeholder:"Confirm Password",minLength:"6",onInput:this.onPasswordChange,required:!0}),i.a.createElement("input",{className:"form-control",name:"displayName",type:"text",placeholder:"Your Display Name"}),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Create"))))),this.state.isOwnerLoginFormVisible&&i.a.createElement("div",{className:"login-container panel"},i.a.createElement("section",null,i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",null,"Workspace ",i.a.createElement("b",null,this.createdWorkspaceName)," Created!"),i.a.createElement("form",{method:"post",onSubmit:this.onOwnerAccountFormSubmit},i.a.createElement("p",{className:"form-description"},"Click ",i.a.createElement("b",null,"Continue")," to login as"," ",i.a.createElement("b",null,this.createdWorkspaceOwnerEmail),"."),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Continue"))))))}}]),t}(i.a.Component)),Fe=function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).apiService=new y(e),n.authService=new M(e),n.onAcceptInvitationFormSubmit=n.onAcceptInvitationFormSubmit.bind(Object(u.a)(n));var a=new URLSearchParams(e.location.search);return n.workspaceName=a.get("workspaceName"),n.email=a.get("email"),n.code=a.get("code"),n.onPasswordChange=n.onPasswordChange.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onAcceptInvitationFormSubmit",value:function(e){var t=this;e.preventDefault();var n=e.target.elements.name.value,a=e.target.elements.password.value;if(this.email&&a&&this.code){var i=e.currentTarget.querySelector("button[type='submit']");i.classList.add("disabled-button"),this.apiService.fetch("/api/users/acceptInvitation",{method:"POST",body:JSON.stringify({email:this.email,password:a,name:n,code:this.code})},!1,!0).then(function(){t.authService.login(t.email,a)}).catch(function(e){S.b.error("Create account failed: ".concat(e)),i.classList.remove("disabled-button")})}}},{key:"onPasswordChange",value:function(){var e=document.querySelector("#acceptInvitation input[name='password']"),t=document.querySelector("#acceptInvitation input[name='confirmPassword']");e.value!==t.value?t.setCustomValidity("Passwords don't match"):t.setCustomValidity("")}},{key:"render",value:function(){return i.a.createElement("div",{className:"login-page"},i.a.createElement("div",{className:"login-container panel"},i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",null,"Join ",this.workspaceName," on iChat"),i.a.createElement("form",{id:"acceptInvitation",method:"post",onSubmit:this.onAcceptInvitationFormSubmit},i.a.createElement("p",{className:"form-description"},"Enter your name and password to create account."),i.a.createElement("input",{className:"form-control",name:"name",type:"text",placeholder:"Display name"}),i.a.createElement("input",{className:"form-control",name:"password",type:"password",placeholder:"Password",minLength:"6",onInput:this.onPasswordChange,required:!0}),i.a.createElement("input",{className:"form-control",name:"confirmPassword",type:"password",placeholder:"Confirm Password",minLength:"6",onInput:this.onPasswordChange,required:!0}),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Create Account")))))}}]),t}(i.a.Component),Ie=function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(c.a)(this,Object(m.a)(t).call(this,e))).apiService=new y(e),n.authService=new M(e),n.onResetPasswordFormSubmit=n.onResetPasswordFormSubmit.bind(Object(u.a)(n));var a=new URLSearchParams(e.location.search);return n.email=a.get("email"),n.code=a.get("code"),n.onPasswordChange=n.onPasswordChange.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onResetPasswordFormSubmit",value:function(e){var t=this;e.preventDefault();var n=e.target.elements.password.value;if(this.email&&n&&this.code){var a=e.currentTarget.querySelector("button[type='submit']");a.classList.add("disabled-button"),this.apiService.fetch("/api/users/resetPassword",{method:"POST",body:JSON.stringify({email:this.email,password:n,code:this.code})},!1,!0).then(function(){t.authService.login(t.email,n)}).catch(function(e){S.b.error("Reset password failed: ".concat(e)),a.classList.remove("disabled-button")})}}},{key:"onPasswordChange",value:function(){var e=document.querySelector("#resetPassword input[name='password']"),t=document.querySelector("#resetPassword input[name='confirmPassword']");e.value!==t.value?t.setCustomValidity("Passwords don't match"):t.setCustomValidity("")}},{key:"render",value:function(){return i.a.createElement("div",{className:"login-page"},i.a.createElement("div",{className:"login-container panel"},i.a.createElement("div",{className:"form-container"},i.a.createElement("h1",null,"Reset password"),i.a.createElement("form",{id:"resetPassword",method:"post",onSubmit:this.onResetPasswordFormSubmit},i.a.createElement("p",{className:"form-description"},"Enter your new password."),i.a.createElement("input",{className:"form-control",name:"password",type:"password",placeholder:"Password",minLength:"6",onInput:this.onPasswordChange,required:!0}),i.a.createElement("input",{className:"form-control",name:"confirmPassword",type:"password",placeholder:"Confirm Password",minLength:"6",onInput:this.onPasswordChange,required:!0}),i.a.createElement("button",{type:"submit",className:"btn form-control"},"Reset & Login")))))}}]),t}(i.a.Component),Le=n(70),Te=n(306);var Ue=function(e){var t=e.component,n=Object(Te.a)(e,["component"]),a=new M;return i.a.createElement(Le.b,Object.assign({},n,{render:function(e){return a.isLoggedIn()?i.a.createElement(t,e):i.a.createElement(Le.a,{to:{pathname:"/login",state:{from:e.location}}})}}))};n(555);S.b.configure({position:"top-center",autoClose:4e3,hideProgressBar:!0,newestOnTop:!1,closeOnClick:!0,pauseOnVisibilityChange:!0,draggable:!0,pauseOnHover:!0,transition:S.a});var De=function(){return i.a.createElement("div",{id:"container"},i.a.createElement(d.a,null,i.a.createElement(Le.d,null,i.a.createElement(Le.b,{path:"/login",component:Pe}),i.a.createElement(Le.b,{path:"/user/acceptinvitation",component:Fe}),i.a.createElement(Le.b,{path:"/user/resetPassword",component:Ie}),i.a.createElement(Ue,{path:"/",exact:!0,component:we}),i.a.createElement(Ue,{path:"/:section/:id",component:we}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(De,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[320,1,2]]]);
//# sourceMappingURL=main.47532ec0.chunk.js.map